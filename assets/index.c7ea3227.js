var Ee=Object.defineProperty,Be=Object.defineProperties;var Ce=Object.getOwnPropertyDescriptors;var re=Object.getOwnPropertySymbols;var Ae=Object.prototype.hasOwnProperty,De=Object.prototype.propertyIsEnumerable;var te=(e,t,o)=>t in e?Ee(e,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[t]=o,b=(e,t)=>{for(var o in t||(t={}))Ae.call(t,o)&&te(e,o,t[o]);if(re)for(var o of re(t))De.call(t,o)&&te(e,o,t[o]);return e},R=(e,t)=>Be(e,Ce(t));var X=(e,t,o)=>(te(e,typeof t!="symbol"?t+"":t,o),o);import{o as c,c as d,a as l,F as G,r as W,n as q,w as be,t as y,b as g,p as H,d as K,e as E,m as Q,f as Y,g as T,h as w,i as $e,j as we,u as J,k as Z,l as Se,T as le,E as ce,q as ke,s as Re,v as Ie}from"./vendor.01c14e24.js";const Pe=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))s(a);new MutationObserver(a=>{for(const u of a)if(u.type==="childList")for(const n of u.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&s(n)}).observe(document,{childList:!0,subtree:!0});function o(a){const u={};return a.integrity&&(u.integrity=a.integrity),a.referrerpolicy&&(u.referrerPolicy=a.referrerpolicy),a.crossorigin==="use-credentials"?u.credentials="include":a.crossorigin==="anonymous"?u.credentials="omit":u.credentials="same-origin",u}function s(a){if(a.ep)return;a.ep=!0;const u=o(a);fetch(a.href,u)}};Pe();var D;(function(e){e.title="title",e.roleSelect="roleSelect",e.main="main",e.lose="lose",e.clearance="clearance"})(D||(D={}));var v;(function(e){e.found="found",e.visited="visited",e.mist="mist"})(v||(v={}));const Oe={locationUnit:32,regionGap:8,mistRegionColor:"#666",foundRegionColor:"#9d2"};function oe(e,t=!0,o=!0){if(e&&e.length>0){var s=t?18:15,a=o?13:9,u=de(e)%s;t&&u>15&&(a=9);var n=de(e)%a;return Te[n][u]}else console.log("Error: String not valid")}function de(e){for(var t=5381,o=0;o<e.length;o++){var s=e.charCodeAt(o);t=(t<<5)+t+s}return Math.abs(t)}const Te=[["#FFEBEE","#FCE4EC","#F3E5F5","#EDE7F6","#E8EAF6","#E3F2FD","#E1F5FE","#E0F7FA","#E0F2F1","#E8F5E9","#F1F8E9","#F9FBE7","#FFFDE7","#FFF8E1","#FFF3E0","#FBE9E7","#EFEBE9","#FAFAFA","#ECEFF1"],["#FFCDD2","#F8BBD0","#E1BEE7","#D1C4E9","#C5CAE9","#BBDEFB","#B3E5FC","#B2EBF2","#B2DFDB","#C8E6C9","#DCEDC8","#F0F4C3","#FFF9C4","#FFECB3","#FFE0B2","#FFCCBC","#D7CCC8","#F5F5F5","#CFD8DC"],["#EF9A9A","#F48FB1","#CE93D8","#B39DDB","#9FA8DA","#90CAF9","#81D4FA","#80DEEA","#80CBC4","#A5D6A7","#C5E1A5","#E6EE9C","#FFF59D","#FFE082","#FFCC80","#FFAB91","#BCAAA4","#EEEEEE","#B0BEC5"],["#E57373","#F06292","#BA68C8","#9575CD","#7986CB","#64B5F6","#4FC3F7","#4DD0E1","#4DB6AC","#81C784","#AED581","#DCE775","#FFF176","#FFD54F","#FFB74D","#FF8A65","#A1887F","#E0E0E0","#90A4AE"],["#EF5350","#EC407A","#AB47BC","#7E57C2","#5C6BC0","#42A5F5","#29B6F6","#26C6DA","#26A69A","#66BB6A","#9CCC65","#D4E157","#FFEE58","#FFCA28","#FFA726","#FF7043","#8D6E63","#BDBDBD","#78909C"],["#F44336","#E91E63","#9C27B0","#673AB7","#3F51B5","#2196F3","#03A9F4","#00BCD4","#009688","#4CAF50","#8BC34A","#CDDC39","#FFEB3B","#FFC107","#FF9800","#FF5722","#795548","#9E9E9E","#607D8B"],["#E53935","#D81B60","#8E24AA","#5E35B1","#3949AB","#1E88E5","#039BE5","#00ACC1","#00897B","#43A047","#7CB342","#C0CA33","#FDD835","#FFB300","#FB8C00","#F4511E","#6D4C41","#757575","#546E7A"],["#D32F2F","#C2185B","#7B1FA2","#512DA8","#303F9F","#1976D2","#0288D1","#0097A7","#00796B","#388E3C","#689F38","#AFB42B","#FBC02D","#FFA000","#F57C00","#E64A19","#5D4037","#616161","#455A64"],["#C62828","#AD1457","#6A1B9A","#4527A0","#283593","#1565C0","#0277BD","#00838F","#00695C","#2E7D32","#558B2F","#9E9D24","#F9A825","#FF8F00","#EF6C00","#D84315","#4E342E","#424242","#37474F"],["#B71C1C","#880E4F","#4A148C","#311B92","#1A237E","#0D47A1","#01579B","#006064","#004D40","#1B5E20","#33691E","#827717","#F57F17","#FF6F00","#E65100","#BF360C","#3E2723","#212121","#263238"],["#FF8A80","#FF80AB","#EA80FC","#B388FF","#8C9EFF","#82B1FF","#80D8FF","#84FFFF","#A7FFEB","#B9F6CA","#CCFF90","#F4FF81","#FFFF8D","#FFE57F","#FFD180","#FF9E80"],["#FF5252","#FF4081","#E040FB","#7C4DFF","#536DFE","#448AFF","#40C4FF","#18FFFF","#64FFDA","#69F0AE","#B2FF59","#EEFF41","#FFFF00","#FFD740","#FFAB40","#FF6E40"],["#FF1744","#F50057","#D500F9","#651FFF","#3D5AFE","#2979FF","#00B0FF","#00E5FF","#1DE9B6","#00E676","#76FF03","#C6FF00","#FFEA00","#FFC400","#FF9100","#FF3D00"],["#D50000","#C51162","#AA00FF","#6200EA","#304FFE","#2962FF","#0091EA","#00B8D4","#00BFA5","#00C853","#64DD17","#AEEA00","#FFD600","#FFAB00","#FF6D00","#DD2C00"]],pe=e=>(H("data-v-601dc8f8"),e=e(),K(),e),Le=["onPointerenter","onPointerdown"],Me={key:0,class:"monster"},je={class:"name"},xe={class:"hp"},Ve={key:1,class:"value"},Ne={key:0,class:"name"},He={key:1,class:"name"},Ke={key:2,class:"value"},Ye=pe(()=>l("div",{class:"name"},"\u59CB",-1)),Ue=[Ye],Xe={key:3,class:"value"},Ge=pe(()=>l("div",{class:"name"},"\u5B9D",-1)),We=[Ge],qe={key:4,class:"value"},Qe={class:"name"};function Je(e,t,o,s,a,u){return c(),d("div",{class:"dungeon-container",onPointerdown:t[2]||(t[2]=(...n)=>e.pointerdown&&e.pointerdown(...n)),onPointerup:t[3]||(t[3]=(...n)=>e.pointerup&&e.pointerup(...n)),onPointermove:t[4]||(t[4]=(...n)=>e.pointermove&&e.pointermove(...n))},[l("div",{class:"dungeon",style:q({top:e.offsetY+"px",left:e.offsetX+"px"})},[(c(!0),d(G,null,W(e.reginList,n=>(c(),d("div",{class:"region",style:q(e.makeRegionStyle(n)),onPointerleave:t[0]||(t[0]=(...r)=>e.regionPointerLeave&&e.regionPointerLeave(...r)),onPointerenter:r=>e.regionPointerEnter(n),onPointerdown:be(r=>e.regionPointerDown(n.id),["stop"]),onPointerup:t[1]||(t[1]=(...r)=>e.regionPointerUp&&e.regionPointerUp(...r))},[(n.type==="monster"||n.type==="boss")&&n.status!=="mist"?(c(),d("div",Me,[l("div",je,y(n.name),1),l("div",xe,"("+y(n.hp[0])+"/"+y(n.hp[1])+")",1)])):g("",!0),n.type==="value"&&n.status!=="mist"?(c(),d("div",Ve,[n.onlyValue?(c(),d("div",He,y(n.value),1)):(c(),d("div",Ne,y(n.name),1))])):g("",!0),n.type==="started"&&n.status!=="mist"?(c(),d("div",Ke,Ue)):g("",!0),n.type==="chest"&&n.status!=="mist"?(c(),d("div",Xe,We)):g("",!0),(n.type==="chanel"||n.type==="shop")&&n.status!=="mist"?(c(),d("div",qe,[l("div",Qe,y(n.name),1)])):g("",!0)],44,Le))),256))],4)],32)}var B=(e,t)=>{const o=e.__vccOpts||e;for(const[s,a]of t)o[s]=a;return o};const{locationUnit:z,foundRegionColor:Ze,mistRegionColor:ze,regionGap:ve}=Oe,et=E({data(){return{downX:-1,downY:-1,nowOffsetX:0,nowOffsetY:0,timeoutHandler:null,intervalHandler:null}},computed:Q({offsetX:e=>e.ui.offset[0],offsetY:e=>e.ui.offset[1],reginList:e=>{var t;return(t=e.dungeon)==null?void 0:t.regionIds.map(o=>{var s;return(s=e.dungeon)==null?void 0:s.regions[o]})},activeRegion:e=>{var t;return(t=e.dungeon)==null?void 0:t.regions[e.ui.activeRegionId]}}),unmounted(){this.regionPointerUp()},methods:R(b({},Y(["updateOffset","visitRegion","updateActiveRegionId"])),{makeRegionStyle(e){let t={};return e.status===v.mist&&(t.backgroundColor=ze),(e.status===v.found||e.status===v.visited)&&(Object.keys(e).indexOf("name")!==-1?(t.color=oe(e.name+"-font-color",!1,!1),t.backgroundColor=oe(e.name,!1)):t.backgroundColor=Ze),e.status===v.visited&&(t.opacity=.6),b({width:e.width*z-ve+"px",height:e.height*z-ve+"px",left:e.x*z+"px",top:e.y*z+"px"},t)},pointerdown(e){this.downX=e.x,this.downY=e.y,this.nowOffsetX=this.offsetX,this.nowOffsetY=this.offsetY},pointermove(e){if(this.downX!==-1&&this.downY!==-1){let t=e.x-this.downX+this.nowOffsetX,o=e.y-this.downY+this.nowOffsetY;this.updateOffset({offset:[t,o]})}},pointerup(){this.downX=-1,this.downY=-1},regionPointerDown(e){this.visitRegion({id:e}),this.activeRegion&&this.activeRegion.type==="monster"&&(this.timeoutHandler=setTimeout(()=>{this.intervalHandler=setInterval(()=>{this.visitRegion({id:e})},100)},200))},regionPointerUp(){this.timeoutHandler&&clearTimeout(this.timeoutHandler),this.intervalHandler&&clearInterval(this.intervalHandler)},regionPointerEnter(e){e.status===v.found&&this.updateActiveRegionId({id:e.id})},regionPointerLeave(){this.updateActiveRegionId({id:null})}})});var tt=B(et,[["render",Je],["__scopeId","data-v-601dc8f8"]]);function ot(e,t,o,s,a,u){return c(),d("div",{class:"icon",style:q(e.style)},null,4)}const nt=E({props:["type"],computed:{style(){return{backgroundImage:`url(icons/${this.type}.png)`,width:"16px",height:"16px",backgroundSize:"100% 100%"}}}});var st=B(nt,[["render",ot]]);const at={class:"double-bar"},it={class:"value"};function ut(e,t,o,s,a,u){return c(),d("div",at,[l("div",{class:"fill",style:q({"background-color":e.color,left:`-${(1-e.percentage)*100}%`})},null,4),l("div",it,y(e.value),1)])}const rt=E({props:["color","value","percentage"]});var lt=B(rt,[["render",ut],["__scopeId","data-v-39186694"]]);const ct={key:0,class:"region-panel"},dt={key:0,class:"panel"},pt=l("div",{class:"content"},"\u70B9\u51FB\u5F00\u59CB\u63A2\u7D22",-1),vt=[pt],ft={key:1,class:"panel"},Ft={class:"content"};function ht(e,t,o,s,a,u){return e.region?(c(),d("div",ct,[e.region.type==="started"?(c(),d("div",dt,vt)):g("",!0),e.region.type==="value"||e.region.type==="monster"||e.region.type==="boss"||e.region.type==="chanel"||e.region.type==="shop"?(c(),d("div",ft,[l("div",Ft,y(e.region.name)+": "+y(e.region.description),1)])):g("",!0)])):g("",!0)}const _t=E({props:["region"]});var mt=B(_t,[["render",ht]]);const yt={class:"player-panel"},gt={class:"player-header"},Et={class:"avatar"},Bt={class:"values-panel"},Ct=["title"],At={class:"icon"},Dt=["title"],bt={class:"icon"},$t={class:"value"},wt={class:"tool-tip"};function St(e,t,o,s,a,u){const n=T("icon"),r=T("DoubleBar"),C=T("RegionInfo");return c(),d("div",yt,[l("div",gt,[l("div",Et,y(e.avatar),1),l("div",Bt,[(c(!0),d(G,null,W(e.doubleValues,f=>(c(),d("div",{class:"values",title:f.name},[l("span",At,[w(n,{type:f.icon},null,8,["type"])]),w(r,{color:e.getColorFromString(f.name+"10"),value:`${f.value[0]}/${f.value[1]}`,percentage:f.value[0]/f.value[1]},null,8,["color","value","percentage"])],8,Ct))),256)),(c(!0),d(G,null,W(e.values,f=>(c(),d("div",{class:"values",title:f.name},[l("span",bt,[w(n,{type:f.icon},null,8,["type"])]),l("span",$t,y(f.value),1)],8,Dt))),256))])]),l("div",wt,[w(C,{region:e.activeRegion},null,8,["region"])])])}const kt=E({components:{icon:st,DoubleBar:lt,RegionInfo:mt},methods:{getColorFromString:oe},computed:Q({doubleValues:e=>Object.getOwnPropertySymbols(e.player.doubleValues).map(t=>e.player.doubleValues[t]).sort((t,o)=>t.order-o.order),values:e=>Object.getOwnPropertySymbols(e.player.values).map(t=>e.player.values[t]).sort((t,o)=>t.order-o.order),avatar:e=>e.player.avatar,activeRegion:e=>{var t;return(t=e.dungeon)==null?void 0:t.regions[e.ui.activeRegionId]}})});var Rt=B(kt,[["render",St],["__scopeId","data-v-31122e54"]]);const It={class:"ui"},Pt={class:"top"},Ot=E({setup(e){return(t,o)=>(c(),d("div",It,[l("div",Pt,[w(Rt)])]))}});var Tt=B(Ot,[["__scopeId","data-v-4c1b6bfc"]]);const Lt=e=>(H("data-v-9631f8bc"),e=e(),K(),e),Mt={key:0,class:"shop"},jt={class:"container"},xt={class:"box"},Vt=Lt(()=>l("div",{class:"title"},"\u796D",-1)),Nt={class:"description"},Ht={class:"content"},Kt=["onPointerover","onClick"],Yt={class:"p"};function Ut(e,t,o,s,a,u){return e.showShop?(c(),d("div",Mt,[l("div",{class:"wrap",onClick:t[0]||(t[0]=(...n)=>e.closeShop&&e.closeShop(...n))}),l("div",jt,[l("div",xt,[Vt,l("div",Nt,y(e.description),1),l("div",Ht,[(c(!0),d(G,null,W(e.activeShop.goods,n=>(c(),d("div",{class:$e(["item",{"sell-out":n.sellOut}])},[l("div",{class:"head",onPointerover:r=>e.pointerover(n.good.description),onPointerleave:t[1]||(t[1]=(...r)=>e.pointerleave&&e.pointerleave(...r)),onClick:r=>e.buyFromShop({good:n,region:e.activeShop})},y(n.good.name),41,Kt),l("div",Yt,y(n.price)+"\u9B42",1)],2))),256))])])])])):g("",!0)}const Xt=E({data(){return{description:""}},computed:b({},Q({showShop:e=>e.ui.showShop,activeShop:e=>{var t;return(t=e.dungeon)==null?void 0:t.regions[e.ui.activeShopRegionId]}})),methods:R(b({},Y(["closeShop","buyFromShop"])),{pointerover(e){this.description=e},pointerleave(){this.description=""}})});var Gt=B(Xt,[["render",Ut],["__scopeId","data-v-9631f8bc"]]);const Wt={class:"main"};function qt(e,t,o,s,a,u){const n=T("Dungeon"),r=T("UI"),C=T("Shop");return c(),d("div",Wt,[w(n),w(r),w(C)])}const Qt=E({components:{Dungeon:tt,UI:Tt,Shop:Gt}});var Jt=B(Qt,[["render",qt]]);const $={monster:{attacked:new Audio("./monster/attacked.mp3")},bgm:{mountain_ghost:new Audio("./bgm/mountain_ghost.mp3")},sound:{click:new Audio("./sound/click.wav")}},Zt=e=>(H("data-v-72aa5c2b"),e=e(),K(),e),zt={class:"title"},eo=Zt(()=>l("div",{class:"brand"},null,-1));function to(e,t,o,s,a,u){return c(),d("div",zt,[eo,l("div",{class:"start-btn",onClick:t[0]||(t[0]=n=>e.start())},"\u620F\u4F5C")])}const oo=E({methods:R(b({},Y(["startGame"])),{start(){$.bgm.mountain_ghost.play(),$.bgm.mountain_ghost.addEventListener("ended",()=>{$.bgm.mountain_ghost.play()}),$.sound.click.play(),this.startGame()}})});var no=B(oo,[["render",to],["__scopeId","data-v-72aa5c2b"]]);const so=e=>(H("data-v-84d5e1bc"),e=e(),K(),e),ao={class:"container"},io=so(()=>l("p",null,"\u62E9\u5176\u4E4B\u4E00",-1)),uo={class:"row"},ro=we('<span class="disable" data-v-84d5e1bc>\u5175</span><span class="disable" data-v-84d5e1bc>\u6597</span><span class="disable" data-v-84d5e1bc>\u8005</span><span class="disable" data-v-84d5e1bc>\u7686</span><span class="disable" data-v-84d5e1bc>\u9635</span><span class="disable" data-v-84d5e1bc>\u5217</span><span class="disable" data-v-84d5e1bc>\u524D</span><span class="disable" data-v-84d5e1bc>\u884C</span>',8);function lo(e,t,o,s,a,u){return c(),d("div",ao,[io,l("div",uo,[l("span",{onClick:t[0]||(t[0]=n=>e.select(0))},"\u4E34"),ro])])}const co=E({methods:R(b({},Y(["selectHeroAndEnterDungeon"])),{select(e){this.selectHeroAndEnterDungeon(e),$.sound.click.play()}})});var po=B(co,[["render",lo],["__scopeId","data-v-84d5e1bc"]]);const fe=e=>(H("data-v-6063823b"),e=e(),K(),e),vo={class:"title"},fo=fe(()=>l("div",{class:"brand"},null,-1)),Fo=fe(()=>l("div",{class:"start-btn"},"Game Over",-1));function ho(e,t,o,s,a,u){return c(),d("div",vo,[fo,Fo,l("div",{class:"restart",onClick:t[0]||(t[0]=(...n)=>e.toTitle&&e.toTitle(...n))},"\u91CD\u65B0\u5F00\u59CB")])}const _o=E({methods:b({},Y(["toTitle"]))});var mo=B(_o,[["render",ho],["__scopeId","data-v-6063823b"]]);const yo={class:"container"},go=E({computed:Q(["stage"]),mounted(){}}),Eo=E(R(b({},go),{setup(e){return(t,o)=>(c(),d("div",yo,[t.stage===J(D).main?(c(),Z(Jt,{key:0})):g("",!0),t.stage===J(D).title?(c(),Z(no,{key:1})):g("",!0),t.stage===J(D).roleSelect?(c(),Z(po,{key:2})):g("",!0),t.stage===J(D).lose?(c(),Z(mo,{key:3})):g("",!0)]))}}));var Bo=B(Eo,[["__scopeId","data-v-16e7bc1c"]]);function S(e,t){return Math.round(Math.random()*(t-e)+e)}function Co(e=.5){return Math.random()>e}function Fe(e){const t=e.reduce((s,[a,u])=>s+u,0),o=e.sort(([s,a],[u,n])=>n-a);return()=>{const s=S(0,t);let a=0;for(const[u,n]of o)if(a+=n,a>=s)return u;throw new Error}}const _={attack:Symbol("attack"),defense:Symbol("defense"),soul:Symbol("soul")},m={hp:Symbol("hp"),mp:Symbol("mp"),ps:Symbol("ps"),rage:Symbol("rage")},Ao=[{avatar:"\u4E34",doubleValues:{[m.hp]:{key:m.hp,name:"HP",value:[100,100],order:1,icon:"ui_hp"},[m.mp]:{key:m.mp,name:"MP",value:[60,60],order:2,icon:"ui_mp"},[m.ps]:{key:m.ps,name:"PS",value:[120,120],order:3,icon:"ui_ps"},[m.rage]:{key:m.rage,name:"\u6012",value:[0,100],order:4,icon:"ui_rage"}},values:{[_.attack]:{key:_.attack,name:"\u653B\u51FB\u529B",value:7,order:5,icon:"ui_attack"},[_.defense]:{key:_.defense,name:"\u9632\u5FA1\u529B",value:6,order:6,icon:"ui_defense"},[_.soul]:{key:_.soul,name:"\u9B42",value:0,order:7,icon:"ui_soul"}}}],he=[[()=>({name:"\u72D0",hp:[100,100],attack:32,defense:13,soul:6,description:"\u653B: 32 \u9632: 13 \u8D4F: 6\u9B42"}),1]];he.sort((e,t)=>e[1]-t[1]);const _e=[[()=>({name:"\u9E21",hp:[10,10],attack:12,defense:5,soul:1,description:"\u653B: 12 \u9632: 5 \u8D4F: 1\u9B42"}),1],[()=>({name:"\u72AC",hp:[16,16],attack:20,defense:2,soul:2,description:"\u653B: 20 \u9632: 2 \u8D4F: 2\u9B42"}),1]];_e.sort((e,t)=>e[1]-t[1]);const Do=[[e=>{e.type="monster",Object.assign(e,Fe(_e)()())},4],[e=>{e.type="value";const t=e;t.name="\u6CC9",t.value=10,t.description="HP +10",t.valueKey=m.hp},1],[e=>{e.type="value";const t=e;t.name="\u795D",t.value=3,t.description="\u653B\u51FB\u529B +3",t.valueKey=_.attack},1],[e=>{e.type="value";const t=e;t.name="\u7532",t.value=4,t.description="\u9632\u5FA1\u529B +4",t.valueKey=_.defense},1],[e=>{e.type="value";const t=e;t.name="\u7A74",t.value=10,t.description="PS +10",t.valueKey=m.ps},1]];function bo(e){const t=e[0];t.type="boss";const{defense:o,attack:s,hp:a,name:u,description:n}=he[0][0]();t.attack=s,t.defense=o,t.hp=a,t.name=u,t.description=n;const r=e[1];return r.type="shop",r.name="\u796D",r.description="\u4F9B\u5949\u4E00\u5B9A\u6570\u91CF\u7684\u9B42, \u6362\u53D6\u6CD5\u5668",r.goods=[{price:3,good:{name:"\u8865\u7075\u6563",description:"HP +15",type:"value",valueKey:m.hp,value:15}},{price:7,good:{name:"\u8865\u6C14\u6563",description:"\u4F53\u529B +20",type:"value",valueKey:m.ps,value:20}},{price:30,good:{name:"\u8349\u5DE1",description:"\u653B\u51FB\u529B +30",type:"value",valueKey:_.attack,value:30}}],e.slice(2)}function $o(e){let t=1/0,o=1/0,s=-1/0,a=-1/0;for(const n of e)n.x>s&&(s=n.x),n.x<t&&(t=n.x),n.y>a&&(a=n.y),n.y<o&&(o=n.y);const u=s-t+1>=2&&a-o+1>=2;return{x:t,y:o,width:s-t+1,height:a-o+1,fits:new Set(e.map(n=>n.id)),isRoom:u,adjacent:new Set,id:e[0].id,status:v.mist,type:"blank"}}function wo(e=32){const t=[],o=i=>t[Math.floor(i/e)][i%e],s=new Set,a=[],u=({x:i,y:p},F,h)=>{var O;return((O=t[i+F])!=null?O:[])[p+h]},n=(i,p)=>([F,h])=>u({x:i,y:p},F,h),r=i=>({x:p,y:F})=>i.map(n(p,F)),C=[[[0,1]],[[0,-1]],[[1,0]],[[-1,0]],[[0,1],[0,2]],[[0,-1],[0,-2]],[[1,0],[2,0]],[[-1,0],[-2,0]],[[0,1],[0,2],[0,3]],[[0,-1],[0,-2],[0,-3]],[[1,0],[2,0],[3,0]],[[-1,0],[-2,0],[-3,0]]].map(r),f=[r([[1,0],[0,1],[1,1]]),r([[-1,0],[-1,1],[0,1]]),r([[-1,0],[-1,-1],[0,-1]]),r([[1,0],[1,-1],[0,-1]]),r([[1,0],[2,0],[2,-1],[1,-1],[0,-1]]),r([[-1,0],[-2,0],[-2,-1],[-1,-1],[0,-1]]),r([[0,1],[1,1],[2,1],[2,0],[1,0]]),r([[-1,0],[-2,0],[-2,1],[-1,1],[0,1]]),r([[1,0],[2,0],[2,-1],[1,-1],[0,-1],[0,-2],[1,-2],[2,-2]]),r([[-1,0],[-2,0],[-2,-1],[-1,-1],[0,-1],[0,-2],[-1,-2],[-2,-2],[]]),r([[0,1],[1,1],[2,1],[2,0],[1,0],[0,2],[1,2],[2,2]]),r([[-1,0],[-2,0],[-2,1],[-1,1],[0,1],[0,2],[-1,2],[-2,2]])];let x=0;for(let i=0;i<e;i++){t[i]=[];for(let p=0;p<e;p++)t[i][p]={x:i,y:p,id:x++}}const A=t.flat();for(let i=0;i<4*e;i++){const p=S(0,A.length-1),F=A[p];if(s.has(F))continue;s.add(F);const h=f.filter(k=>k(F).every(N=>N!==void 0&&!s.has(N)));if(h.length===0)continue;const V=h[S(0,h.length-1)](F);V.forEach(k=>s.add(k)),a.push([F].concat(V))}for(let i=0;i<e*e;i++){const p=S(0,A.length-1),F=A[p];if(s.has(F))continue;s.add(F);const h=C.filter(k=>k(F).every(N=>N!==void 0&&!s.has(N)));if(h.length===0)continue;const V=h[S(0,h.length-1)](F);V.forEach(k=>s.add(k)),a.push([F].concat(V))}const U=A.filter(i=>!s.has(i)).map(i=>[Math.abs(i.x-e/2)+Math.abs(i.y-e/2),i]).sort(([i],[p])=>i-p)[0][1],ae=R(b({},U),{width:1,height:1,fits:new Set([U.id]),status:v.found,adjacent:new Set,isRoom:!0,type:"started"}),ie={};let P=a.map($o).filter(i=>i.x!==0&&i.y!==0&&i.x+i.width!==e&&i.y+i.height!==e).filter(i=>!(Co()&&i.fits.size<=4&&(i.width===1||i.height===1))).concat([ae]);P.forEach(i=>ie[i.id]=i);for(const i of P)for(const p of i.fits.values()){const F=[[0,1],[0,-1],[1,0],[-1,0]].map(n(o(p).x,o(p).y)).filter(Boolean);P.filter(h=>F.some(O=>h.fits.has(O.id)&&h!==i)).forEach(h=>i.adjacent.add(h.id))}const ee=new Set;function ue(i){ee.has(i)||(ee.add(i),i.adjacent.forEach(p=>ue(ie[p])))}return ue(ae),P=P.filter(i=>ee.has(i)),P}function So(e=32){let t=[];for(;t.filter(o=>o.isRoom).length<e;)t=wo(e);return t}function ko(e){e.forEach(t=>{const o=t;o.type="value",o.name="\u68EE",o.isNegate=!0,o.onlyValue=!0,o.value=S(1,6),o.valueKey=m.ps,o.description=`\u4E00\u7247\u68EE\u6797\u6321\u5728\u4E86\u4F60\u7684\u524D\u9762, \u6D88\u8017${o.value}\u70B9\u4F53\u529B, \u6467\u6BC1\u5B83`})}function Ro(){const e=[],t={},o=So(32);let s=[];const a=[];o.forEach(n=>{e.push(n.id),t[n.id]=n,n.isRoom&&n.type==="blank"?s.push(n):!n.isRoom&&n.type==="blank"&&a.push(n)}),s=bo(s);const u=Fe(Do);return s.forEach(n=>u()(n)),ko(a),{regionIds:e,regions:t}}function ne(e){e.dungeon=Ro()}function Io(e,t){e.ui.offset=t.offset}function Po(e,t){e.ui.activeRegionId=t.id}function Oo(e){e.ui.showShop=!1}class To{constructor(){X(this,"injuryNumbers",new Set);X(this,"message",new Set);X(this,"cursor",[0,0])}addInjuryNumber(t){this.injuryNumbers.add(t),new le(t).to({opacity:.8,x:t.x+S(-30,30),y:t.y+S(-30,30)},400).easing(ce.Quadratic.InOut).onComplete(()=>{this.injuryNumbers.delete(t)}).start()}addInjuryNumberAtCursor(t){const[o,s]=this.cursor;this.addInjuryNumber({opacity:1,x:o,y:s,value:t})}addMessage(t){const o={msg:t,t:1};this.message.add(o),new le(o).to({t:0},1e3).easing(ce.Quadratic.InOut).onComplete(()=>{this.message.delete(o)}).start()}}const L=new To;function Lo(){const e=document.createElement("canvas");e.width=window.innerWidth,e.height=window.innerHeight,e.style.cssText=`
    top:0;
    left:0;
    position: fixed;
    pointer-events: none;
  `,document.body.appendChild(e);const t=n=>{L.cursor=[n.clientX,n.clientY]};window.addEventListener("pointerdown",t,{capture:!0}),window.addEventListener("pointermove",t,{capture:!0});const o=e.getContext("2d");function s(){L.injuryNumbers.forEach(n=>{const{value:r,opacity:C,x:f,y:x}=n,A=r.toString(),I=18;o.font=`${I}px Arial`,o.fillStyle=`rgba(255,0,0,${C})`;const{width:U}=o.measureText(A);o.fillText(A,f-U/2,x+I/2)})}function a(){L.message.forEach(n=>{const{msg:r,t:C}=n,f=24;o.font=`${f}px Arial`;const{width:x}=o.measureText(r),[A,I]=[window.innerWidth,window.innerHeight];o.fillStyle="rgba(0,0,0,0.5)",o.fillRect(0,(I-200-f+C*200)/2,A,f+8),o.fillStyle=`rgba(255,255,255,${C})`,o.fillText(r,(A-x)/2,(I+f-200+C*200)/2)})}function u(){Se(),o.clearRect(0,0,e.width,e.height),s(),a(),requestAnimationFrame(u)}u()}const M=(e,t)=>{t.status===v.found&&($.sound.click.currentTime=0,$.sound.click.play(),t.status=v.visited,t.adjacent.forEach(o=>{var a;const s=(a=e.dungeon)==null?void 0:a.regions[o];s&&s.status===v.mist&&(s.status=v.found)}))},me=(e,t)=>{if(!(t.status!==v.found||t.type!=="monster"&&t.type!=="boss")&&e.player){e.player.values;const o=e.player.values[_.attack].value-t.defense,s=t.attack-e.player.values[_.defense].value;L.addInjuryNumberAtCursor(-Math.max(0,o)),t.hp[0]=Math.max(0,t.hp[0]-Math.max(0,o)),e.player.doubleValues[m.hp].value[0]=Math.max(0,e.player.doubleValues[m.hp].value[0]-Math.max(0,s)),$.monster.attacked.currentTime=0,$.monster.attacked.play(),t.hp[0]===0&&(e.player.values[_.soul].value+=t.soul,M(e,t),t.type==="boss"&&(t.status=v.found,t.type="chest",t.from="boss"))}},Mo=(e,t)=>{console.log("TODO: \u8FD9\u91CC\u5E94\u8BE5\u6709\u4E2A\u9009\u62E9\u5956\u52B1\u7684\u754C\u9762,\u9009\u62E9\u540E\u624D\u4F1A\u51FA\u73B0\u4F20\u9001\u9635"),M(e,t);const o=t;o.type="chanel",o.name="\u9635",o.status=v.found,o.description="\u4F20\u9001\u81F3\u4E0B\u4E00\u8F6E\u56DE"},jo=(e,t)=>{ne(e)},xo=(e,t)=>{ye(e,t),M(e,t)};function ye(e,t){var s,a;const o=t.isNegate?-1:1;if(Object.getOwnPropertySymbols((s=e.player)==null?void 0:s.doubleValues).indexOf(t.valueKey)!==-1){if(t.isNegate&&e.player.doubleValues[t.valueKey].value[0]<t.value){L.addMessage(`${e.player.doubleValues[t.valueKey].name} \u4E0D\u8DB3`);return}e.player.doubleValues[t.valueKey].value[0]=Math.min(e.player.doubleValues[t.valueKey].value[1],e.player.doubleValues[t.valueKey].value[0]+t.value*o)}Object.getOwnPropertySymbols((a=e.player)==null?void 0:a.values).indexOf(t.valueKey)!==-1&&(e.player.values[t.valueKey].value=e.player.values[t.valueKey].value+t.value*o)}const Vo=(e,t)=>{const o=t;e.ui.activeShopRegionId=o.id,e.ui.showShop=!0,M(e,t),o.goods.some(s=>!s.sellOut)&&(o.status=v.found)},No={started:M,blank:M,monster:me,boss:me,chest:Mo,value:xo,chanel:jo,shop:Vo};function Ho(e,{id:t}){var s;const o=(s=e.dungeon)==null?void 0:s.regions[t];if(o&&o.status===v.found){No[o.type](e,o);return}}function Ko(e){var t;(t=e.dungeon)==null||t.regionIds.forEach(o=>{var a;const s=(a=e.dungeon)==null?void 0:a.regions[o];(s==null?void 0:s.status)===v.mist&&(s.status=v.found)})}function Yo(e){e.stage=D.roleSelect}function Uo(e){e.stage=D.title}function ge(e){e.stage=D.main}function Xo(e){e.stage=D.lose}function Go(e,t){e.player=ke(Ao[t]),ne(e),ge(e)}function Wo(e){e.player&&(e.player.values[_.attack].value=1/0,e.player.values[_.defense].value=1/0)}function qo(e,t){const{good:o,region:s}=t;if(o.price>e.player.values[_.soul].value){L.addMessage("\u9B42\u4E0D\u8DB3");return}ye(e,o.good),e.player.values[_.soul].value-=o.price,o.sellOut=!0,s.goods.every(a=>a.sellOut)&&(s.status=v.visited)}var Qo=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",generateDungeon:ne,updateOffset:Io,updateActiveRegionId:Po,closeShop:Oo,visitRegion:Ho,foundAllRegion:Ko,startGame:Yo,enterDungeon:ge,toLose:Xo,toTitle:Uo,selectHeroAndEnterDungeon:Go,invincible:Wo,buyFromShop:qo});const Jo={stage:D.title,ui:{offset:[0,0]}},j=Re({state:Jo,mutations:Qo}),se={foundAllRegion:()=>j.commit("foundAllRegion"),invincible:()=>j.commit("invincible"),debug:()=>{se.foundAllRegion(),se.invincible()}};window._debugger=se;Lo();j.watch(e=>{var t,o;return(o=(t=e.player)==null?void 0:t.doubleValues[m.hp])==null?void 0:o.value[0]},e=>{e!==void 0&&e===0&&j.commit("toLose")});window.game=j;Ie(Bo).use(j).mount("#game");
