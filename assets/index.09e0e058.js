var Ee=Object.defineProperty,Be=Object.defineProperties;var Ae=Object.getOwnPropertyDescriptors;var re=Object.getOwnPropertySymbols;var Ce=Object.prototype.hasOwnProperty,De=Object.prototype.propertyIsEnumerable;var te=(e,t,o)=>t in e?Ee(e,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[t]=o,$=(e,t)=>{for(var o in t||(t={}))Ce.call(t,o)&&te(e,o,t[o]);if(re)for(var o of re(t))De.call(t,o)&&te(e,o,t[o]);return e},I=(e,t)=>Be(e,Ae(t));var U=(e,t,o)=>(te(e,typeof t!="symbol"?t+"":t,o),o);import{o as l,c as d,a as r,F as G,r as W,n as q,w as $e,t as y,b as g,p as N,d as Y,e as E,m as Q,f as X,g as L,h as k,i as be,j as ke,u as J,k as Z,l as we,T as le,E as ce,q as Se,s as Ie,v as Re}from"./vendor.01c14e24.js";const Oe=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))s(a);new MutationObserver(a=>{for(const u of a)if(u.type==="childList")for(const n of u.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&s(n)}).observe(document,{childList:!0,subtree:!0});function o(a){const u={};return a.integrity&&(u.integrity=a.integrity),a.referrerpolicy&&(u.referrerPolicy=a.referrerpolicy),a.crossorigin==="use-credentials"?u.credentials="include":a.crossorigin==="anonymous"?u.credentials="omit":u.credentials="same-origin",u}function s(a){if(a.ep)return;a.ep=!0;const u=o(a);fetch(a.href,u)}};Oe();var D;(function(e){e.title="title",e.roleSelect="roleSelect",e.main="main",e.lose="lose",e.clearance="clearance"})(D||(D={}));var F;(function(e){e.found="found",e.visited="visited",e.mist="mist"})(F||(F={}));const Pe={locationUnit:32,regionGap:8,mistRegionColor:"#666",foundRegionColor:"#9d2"};function oe(e,t=!0,o=!0){if(e&&e.length>0){var s=t?18:15,a=o?13:9,u=de(e)%s;t&&u>15&&(a=9);var n=de(e)%a;return Le[n][u]}else console.log("Error: String not valid")}function de(e){for(var t=5381,o=0;o<e.length;o++){var s=e.charCodeAt(o);t=(t<<5)+t+s}return Math.abs(t)}const Le=[["#FFEBEE","#FCE4EC","#F3E5F5","#EDE7F6","#E8EAF6","#E3F2FD","#E1F5FE","#E0F7FA","#E0F2F1","#E8F5E9","#F1F8E9","#F9FBE7","#FFFDE7","#FFF8E1","#FFF3E0","#FBE9E7","#EFEBE9","#FAFAFA","#ECEFF1"],["#FFCDD2","#F8BBD0","#E1BEE7","#D1C4E9","#C5CAE9","#BBDEFB","#B3E5FC","#B2EBF2","#B2DFDB","#C8E6C9","#DCEDC8","#F0F4C3","#FFF9C4","#FFECB3","#FFE0B2","#FFCCBC","#D7CCC8","#F5F5F5","#CFD8DC"],["#EF9A9A","#F48FB1","#CE93D8","#B39DDB","#9FA8DA","#90CAF9","#81D4FA","#80DEEA","#80CBC4","#A5D6A7","#C5E1A5","#E6EE9C","#FFF59D","#FFE082","#FFCC80","#FFAB91","#BCAAA4","#EEEEEE","#B0BEC5"],["#E57373","#F06292","#BA68C8","#9575CD","#7986CB","#64B5F6","#4FC3F7","#4DD0E1","#4DB6AC","#81C784","#AED581","#DCE775","#FFF176","#FFD54F","#FFB74D","#FF8A65","#A1887F","#E0E0E0","#90A4AE"],["#EF5350","#EC407A","#AB47BC","#7E57C2","#5C6BC0","#42A5F5","#29B6F6","#26C6DA","#26A69A","#66BB6A","#9CCC65","#D4E157","#FFEE58","#FFCA28","#FFA726","#FF7043","#8D6E63","#BDBDBD","#78909C"],["#F44336","#E91E63","#9C27B0","#673AB7","#3F51B5","#2196F3","#03A9F4","#00BCD4","#009688","#4CAF50","#8BC34A","#CDDC39","#FFEB3B","#FFC107","#FF9800","#FF5722","#795548","#9E9E9E","#607D8B"],["#E53935","#D81B60","#8E24AA","#5E35B1","#3949AB","#1E88E5","#039BE5","#00ACC1","#00897B","#43A047","#7CB342","#C0CA33","#FDD835","#FFB300","#FB8C00","#F4511E","#6D4C41","#757575","#546E7A"],["#D32F2F","#C2185B","#7B1FA2","#512DA8","#303F9F","#1976D2","#0288D1","#0097A7","#00796B","#388E3C","#689F38","#AFB42B","#FBC02D","#FFA000","#F57C00","#E64A19","#5D4037","#616161","#455A64"],["#C62828","#AD1457","#6A1B9A","#4527A0","#283593","#1565C0","#0277BD","#00838F","#00695C","#2E7D32","#558B2F","#9E9D24","#F9A825","#FF8F00","#EF6C00","#D84315","#4E342E","#424242","#37474F"],["#B71C1C","#880E4F","#4A148C","#311B92","#1A237E","#0D47A1","#01579B","#006064","#004D40","#1B5E20","#33691E","#827717","#F57F17","#FF6F00","#E65100","#BF360C","#3E2723","#212121","#263238"],["#FF8A80","#FF80AB","#EA80FC","#B388FF","#8C9EFF","#82B1FF","#80D8FF","#84FFFF","#A7FFEB","#B9F6CA","#CCFF90","#F4FF81","#FFFF8D","#FFE57F","#FFD180","#FF9E80"],["#FF5252","#FF4081","#E040FB","#7C4DFF","#536DFE","#448AFF","#40C4FF","#18FFFF","#64FFDA","#69F0AE","#B2FF59","#EEFF41","#FFFF00","#FFD740","#FFAB40","#FF6E40"],["#FF1744","#F50057","#D500F9","#651FFF","#3D5AFE","#2979FF","#00B0FF","#00E5FF","#1DE9B6","#00E676","#76FF03","#C6FF00","#FFEA00","#FFC400","#FF9100","#FF3D00"],["#D50000","#C51162","#AA00FF","#6200EA","#304FFE","#2962FF","#0091EA","#00B8D4","#00BFA5","#00C853","#64DD17","#AEEA00","#FFD600","#FFAB00","#FF6D00","#DD2C00"]],pe=e=>(N("data-v-6226c496"),e=e(),Y(),e),Me=["onPointerenter","onClick"],Te={key:0,class:"monster"},je={class:"name"},xe={class:"hp"},Ve={key:1,class:"value"},Ke={key:0,class:"name"},Ne={key:1,class:"name"},Ye={key:2,class:"value"},Xe=pe(()=>r("div",{class:"name"},"\u59CB",-1)),He=[Xe],Ue={key:3,class:"value"},Ge=pe(()=>r("div",{class:"name"},"\u5B9D",-1)),We=[Ge],qe={key:4,class:"value"},Qe={class:"name"};function Je(e,t,o,s,a,u){return l(),d("div",{class:"dungeon-container",onPointerdown:t[1]||(t[1]=(...n)=>e.pointerdown&&e.pointerdown(...n)),onPointerup:t[2]||(t[2]=(...n)=>e.pointerup&&e.pointerup(...n)),onPointermove:t[3]||(t[3]=(...n)=>e.pointermove&&e.pointermove(...n))},[r("div",{class:"dungeon",style:q({top:e.offsetY+"px",left:e.offsetX+"px"})},[(l(!0),d(G,null,W(e.reginList,n=>(l(),d("div",{class:"region",style:q(e.makeRegionStyle(n)),onPointerleave:t[0]||(t[0]=(...c)=>e.regionPointerLeave&&e.regionPointerLeave(...c)),onPointerenter:c=>e.regionPointerEnter(n),onClick:$e(c=>e.visitRegion({id:n.id}),["stop"])},[(n.type==="monster"||n.type==="boss")&&n.status!=="mist"?(l(),d("div",Te,[r("div",je,y(n.name),1),r("div",xe,"("+y(n.hp[0])+"/"+y(n.hp[1])+")",1)])):g("",!0),n.type==="value"&&n.status!=="mist"?(l(),d("div",Ve,[n.onlyValue?(l(),d("div",Ne,y(n.value),1)):(l(),d("div",Ke,y(n.name),1))])):g("",!0),n.type==="started"&&n.status!=="mist"?(l(),d("div",Ye,He)):g("",!0),n.type==="chest"&&n.status!=="mist"?(l(),d("div",Ue,We)):g("",!0),(n.type==="chanel"||n.type==="shop")&&n.status!=="mist"?(l(),d("div",qe,[r("div",Qe,y(n.name),1)])):g("",!0)],44,Me))),256))],4)],32)}var B=(e,t)=>{const o=e.__vccOpts||e;for(const[s,a]of t)o[s]=a;return o};const{locationUnit:z,foundRegionColor:Ze,mistRegionColor:ze,regionGap:ve}=Pe,et=E({data(){return{downX:-1,downY:-1,nowOffsetX:0,nowOffsetY:0,timeoutHandler:null,intervalHandler:null}},computed:Q({offsetX:e=>e.ui.offset[0],offsetY:e=>e.ui.offset[1],reginList:e=>{var t;return(t=e.dungeon)==null?void 0:t.regionIds.map(o=>{var s;return(s=e.dungeon)==null?void 0:s.regions[o]})},activeRegion:e=>{var t;return(t=e.dungeon)==null?void 0:t.regions[e.ui.activeRegionId]}}),methods:I($({},X(["updateOffset","visitRegion","updateActiveRegionId"])),{makeRegionStyle(e){let t={};return e.status===F.mist&&(t.backgroundColor=ze),(e.status===F.found||e.status===F.visited)&&(Object.keys(e).indexOf("name")!==-1?(t.color=oe(e.name+"-font-color",!1,!1),t.backgroundColor=oe(e.name,!1)):t.backgroundColor=Ze),e.status===F.visited&&(t.opacity=.6),$({width:e.width*z-ve+"px",height:e.height*z-ve+"px",left:e.x*z+"px",top:e.y*z+"px"},t)},pointerdown(e){this.downX=e.x,this.downY=e.y,this.nowOffsetX=this.offsetX,this.nowOffsetY=this.offsetY},pointermove(e){if(this.downX!==-1&&this.downY!==-1){let t=e.x-this.downX+this.nowOffsetX,o=e.y-this.downY+this.nowOffsetY;this.updateOffset({offset:[t,o]})}},pointerup(){this.downX=-1,this.downY=-1},regionPointerEnter(e){e.status===F.found&&this.updateActiveRegionId({id:e.id})},regionPointerLeave(){this.updateActiveRegionId({id:null})}})});var tt=B(et,[["render",Je],["__scopeId","data-v-6226c496"]]);function ot(e,t,o,s,a,u){return l(),d("div",{class:"icon",style:q(e.style)},null,4)}const nt=E({props:["type"],computed:{style(){return{backgroundImage:`url(icons/${this.type}.png)`,width:"16px",height:"16px",backgroundSize:"100% 100%"}}}});var st=B(nt,[["render",ot]]);const at={class:"double-bar"},it={class:"value"};function ut(e,t,o,s,a,u){return l(),d("div",at,[r("div",{class:"fill",style:q({"background-color":e.color,left:`-${(1-e.percentage)*100}%`})},null,4),r("div",it,y(e.value),1)])}const rt=E({props:["color","value","percentage"]});var lt=B(rt,[["render",ut],["__scopeId","data-v-39186694"]]);const ct={key:0,class:"region-panel"},dt={key:0,class:"panel"},pt=r("div",{class:"content"},"\u70B9\u51FB\u5F00\u59CB\u63A2\u7D22",-1),vt=[pt],ft={key:1,class:"panel"},Ft={class:"content"};function ht(e,t,o,s,a,u){return e.region?(l(),d("div",ct,[e.region.type==="started"?(l(),d("div",dt,vt)):g("",!0),e.region.type==="value"||e.region.type==="monster"||e.region.type==="boss"||e.region.type==="chanel"||e.region.type==="shop"?(l(),d("div",ft,[r("div",Ft,y(e.region.name)+": "+y(e.region.description),1)])):g("",!0)])):g("",!0)}const _t=E({props:["region"]});var mt=B(_t,[["render",ht]]);const yt={class:"player-panel"},gt={class:"player-header"},Et={class:"avatar"},Bt={class:"values-panel"},At=["title"],Ct={class:"icon"},Dt=["title"],$t={class:"icon"},bt={class:"value"},kt={class:"tool-tip"};function wt(e,t,o,s,a,u){const n=L("icon"),c=L("DoubleBar"),A=L("RegionInfo");return l(),d("div",yt,[r("div",gt,[r("div",Et,y(e.avatar),1),r("div",Bt,[(l(!0),d(G,null,W(e.doubleValues,h=>(l(),d("div",{class:"values",title:h.name},[r("span",Ct,[k(n,{type:h.icon},null,8,["type"])]),k(c,{color:e.getColorFromString(h.name+"10"),value:`${h.value[0]}/${h.value[1]}`,percentage:h.value[0]/h.value[1]},null,8,["color","value","percentage"])],8,At))),256)),(l(!0),d(G,null,W(e.values,h=>(l(),d("div",{class:"values",title:h.name},[r("span",$t,[k(n,{type:h.icon},null,8,["type"])]),r("span",bt,y(h.value),1)],8,Dt))),256))])]),r("div",kt,[k(A,{region:e.activeRegion},null,8,["region"])])])}const St=E({components:{icon:st,DoubleBar:lt,RegionInfo:mt},methods:{getColorFromString:oe},computed:Q({doubleValues:e=>Object.getOwnPropertySymbols(e.player.doubleValues).map(t=>e.player.doubleValues[t]).sort((t,o)=>t.order-o.order),values:e=>Object.getOwnPropertySymbols(e.player.values).map(t=>e.player.values[t]).sort((t,o)=>t.order-o.order),avatar:e=>e.player.avatar,activeRegion:e=>{var t;return(t=e.dungeon)==null?void 0:t.regions[e.ui.activeRegionId]}})});var It=B(St,[["render",wt],["__scopeId","data-v-31122e54"]]);const Rt={class:"ui"},Ot={class:"top"},Pt=E({setup(e){return(t,o)=>(l(),d("div",Rt,[r("div",Ot,[k(It)])]))}});var Lt=B(Pt,[["__scopeId","data-v-4c1b6bfc"]]);const Mt=e=>(N("data-v-9631f8bc"),e=e(),Y(),e),Tt={key:0,class:"shop"},jt={class:"container"},xt={class:"box"},Vt=Mt(()=>r("div",{class:"title"},"\u796D",-1)),Kt={class:"description"},Nt={class:"content"},Yt=["onPointerover","onClick"],Xt={class:"p"};function Ht(e,t,o,s,a,u){return e.showShop?(l(),d("div",Tt,[r("div",{class:"wrap",onClick:t[0]||(t[0]=(...n)=>e.closeShop&&e.closeShop(...n))}),r("div",jt,[r("div",xt,[Vt,r("div",Kt,y(e.description),1),r("div",Nt,[(l(!0),d(G,null,W(e.activeShop.goods,n=>(l(),d("div",{class:be(["item",{"sell-out":n.sellOut}])},[r("div",{class:"head",onPointerover:c=>e.pointerover(n.good.description),onPointerleave:t[1]||(t[1]=(...c)=>e.pointerleave&&e.pointerleave(...c)),onClick:c=>e.buyFromShop({good:n,region:e.activeShop})},y(n.good.name),41,Yt),r("div",Xt,y(n.price)+"\u9B42",1)],2))),256))])])])])):g("",!0)}const Ut=E({data(){return{description:""}},computed:$({},Q({showShop:e=>e.ui.showShop,activeShop:e=>{var t;return(t=e.dungeon)==null?void 0:t.regions[e.ui.activeShopRegionId]}})),methods:I($({},X(["closeShop","buyFromShop"])),{pointerover(e){this.description=e},pointerleave(){this.description=""}})});var Gt=B(Ut,[["render",Ht],["__scopeId","data-v-9631f8bc"]]);const Wt={class:"main"};function qt(e,t,o,s,a,u){const n=L("Dungeon"),c=L("UI"),A=L("Shop");return l(),d("div",Wt,[k(n),k(c),k(A)])}const Qt=E({components:{Dungeon:tt,UI:Lt,Shop:Gt}});var Jt=B(Qt,[["render",qt]]);const b={monster:{attacked:new Audio("./monster/attacked.mp3")},bgm:{mountain_ghost:new Audio("./bgm/mountain_ghost.mp3")},sound:{click:new Audio("./sound/click.wav")}},Zt=e=>(N("data-v-72aa5c2b"),e=e(),Y(),e),zt={class:"title"},eo=Zt(()=>r("div",{class:"brand"},null,-1));function to(e,t,o,s,a,u){return l(),d("div",zt,[eo,r("div",{class:"start-btn",onClick:t[0]||(t[0]=n=>e.start())},"\u620F\u4F5C")])}const oo=E({methods:I($({},X(["startGame"])),{start(){b.bgm.mountain_ghost.play(),b.bgm.mountain_ghost.addEventListener("ended",()=>{b.bgm.mountain_ghost.play()}),b.sound.click.play(),this.startGame()}})});var no=B(oo,[["render",to],["__scopeId","data-v-72aa5c2b"]]);const so=e=>(N("data-v-3ff8a1a6"),e=e(),Y(),e),ao={class:"container"},io=so(()=>r("p",null,"\u62E9\u5176\u4E4B\u4E00",-1)),uo={class:"row"},ro=ke('<span class="disable" data-v-3ff8a1a6>\u6597</span><span class="disable" data-v-3ff8a1a6>\u8005</span><span class="disable" data-v-3ff8a1a6>\u7686</span><span class="disable" data-v-3ff8a1a6>\u9635</span><span class="disable" data-v-3ff8a1a6>\u5217</span><span class="disable" data-v-3ff8a1a6>\u524D</span><span class="disable" data-v-3ff8a1a6>\u884C</span>',7);function lo(e,t,o,s,a,u){return l(),d("div",ao,[io,r("div",uo,[r("span",{onClick:t[0]||(t[0]=n=>e.select(0))},"\u4E34"),r("span",{onClick:t[1]||(t[1]=n=>e.select(1))},"\u5175"),ro])])}const co=E({methods:I($({},X(["selectHeroAndEnterDungeon"])),{select(e){this.selectHeroAndEnterDungeon(e),b.sound.click.play()}})});var po=B(co,[["render",lo],["__scopeId","data-v-3ff8a1a6"]]);const fe=e=>(N("data-v-6063823b"),e=e(),Y(),e),vo={class:"title"},fo=fe(()=>r("div",{class:"brand"},null,-1)),Fo=fe(()=>r("div",{class:"start-btn"},"Game Over",-1));function ho(e,t,o,s,a,u){return l(),d("div",vo,[fo,Fo,r("div",{class:"restart",onClick:t[0]||(t[0]=(...n)=>e.toTitle&&e.toTitle(...n))},"\u91CD\u65B0\u5F00\u59CB")])}const _o=E({methods:$({},X(["toTitle"]))});var mo=B(_o,[["render",ho],["__scopeId","data-v-6063823b"]]);const yo={class:"container"},go=E({computed:Q(["stage"]),mounted(){}}),Eo=E(I($({},go),{setup(e){return(t,o)=>(l(),d("div",yo,[t.stage===J(D).main?(l(),Z(Jt,{key:0})):g("",!0),t.stage===J(D).title?(l(),Z(no,{key:1})):g("",!0),t.stage===J(D).roleSelect?(l(),Z(po,{key:2})):g("",!0),t.stage===J(D).lose?(l(),Z(mo,{key:3})):g("",!0)]))}}));var Bo=B(Eo,[["__scopeId","data-v-16e7bc1c"]]);function w(e,t){return Math.round(Math.random()*(t-e)+e)}function Ao(e=.5){return Math.random()>e}function Fe(e){const t=e.reduce((s,[a,u])=>s+u,0),o=e.sort(([s,a],[u,n])=>n-a);return()=>{const s=w(0,t);let a=0;for(const[u,n]of o)if(a+=n,a>=s)return u;throw new Error}}const p={attack:Symbol("attack"),defense:Symbol("defense"),soul:Symbol("soul"),attackSpeed:Symbol("attackSpeed")},v={hp:Symbol("hp"),mp:Symbol("mp"),ps:Symbol("ps"),rage:Symbol("rage")},Co=[{avatar:"\u4E34",doubleValues:{[v.hp]:{key:v.hp,name:"HP",value:[100,100],order:1,icon:"ui_hp"},[v.mp]:{key:v.mp,name:"MP",value:[60,60],order:2,icon:"ui_mp"},[v.ps]:{key:v.ps,name:"\u4F53\u529B",value:[120,120],order:3,icon:"ui_ps"},[v.rage]:{key:v.rage,name:"\u6012",value:[0,100],order:4,icon:"ui_rage"}},values:{[p.attack]:{key:p.attack,name:"\u653B\u51FB\u529B",value:6,order:5,icon:"ui_attack"},[p.attackSpeed]:{key:p.attackSpeed,name:"\u653B\u51FB\u901F\u5EA6",value:1,order:6,icon:"ui_attack_speed"},[p.defense]:{key:p.defense,name:"\u9632\u5FA1\u529B",value:6,order:7,icon:"ui_defense"},[p.soul]:{key:p.soul,name:"\u9B42",value:0,order:8,icon:"ui_soul"}}},{avatar:"\u5175",doubleValues:{[v.hp]:{key:v.hp,name:"HP",value:[80,80],order:1,icon:"ui_hp"},[v.mp]:{key:v.mp,name:"MP",value:[60,60],order:2,icon:"ui_mp"},[v.ps]:{key:v.ps,name:"\u4F53\u529B",value:[100,100],order:3,icon:"ui_ps"},[v.rage]:{key:v.rage,name:"\u6012",value:[0,100],order:4,icon:"ui_rage"}},values:{[p.attack]:{key:p.attack,name:"\u653B\u51FB\u529B",value:3,order:5,icon:"ui_attack"},[p.attackSpeed]:{key:p.attackSpeed,name:"\u653B\u51FB\u901F\u5EA6",value:2,order:6,icon:"ui_attack_speed"},[p.defense]:{key:p.defense,name:"\u9632\u5FA1\u529B",value:9,order:7,icon:"ui_defense"},[p.soul]:{key:p.soul,name:"\u9B42",value:0,order:8,icon:"ui_soul"}}}],he=[[()=>({name:"\u72D0",hp:[100,100],attack:28,defense:8,soul:6,description:"\u653B: 28 \u9632: 8 \u8D4F: 6\u9B42"}),1]];he.sort((e,t)=>e[1]-t[1]);const _e=[[()=>({name:"\u9E21",hp:[10,10],attack:12,defense:2,soul:1,description:"\u653B: 12 \u9632: 2 \u8D4F: 1\u9B42"}),1],[()=>({name:"\u72AC",hp:[16,16],attack:20,defense:1,soul:2,description:"\u653B: 20 \u9632: 1 \u8D4F: 2\u9B42"}),1]];_e.sort((e,t)=>e[1]-t[1]);const Do=[[e=>{e.type="monster",Object.assign(e,Fe(_e)()())},4],[e=>{e.type="value";const t=e;t.name="\u6CC9",t.value=10,t.description="HP +10",t.valueKey=v.hp},1],[e=>{e.type="value";const t=e;t.name="\u795D",t.value=1,t.description="\u653B\u51FB\u529B +1",t.valueKey=p.attack},1],[e=>{e.type="value";const t=e;t.name="\u7532",t.value=1,t.description="\u9632\u5FA1\u529B +1",t.valueKey=p.defense},1],[e=>{e.type="value";const t=e;t.name="\u7A74",t.value=10,t.description="PS +10",t.valueKey=v.ps},1]];function $o(e){const t=e[0];t.type="boss",Object.assign(t,he[0][0]());const o=e[1];return o.type="shop",o.name="\u796D",o.description="\u4F9B\u5949\u4E00\u5B9A\u6570\u91CF\u7684\u9B42, \u6362\u53D6\u6CD5\u5668",o.goods=[{price:3,good:{name:"\u8865\u7075\u6563",description:"HP +15",type:"value",valueKey:v.hp,value:15}},{price:3,good:{name:"\u8865\u6C14\u6563",description:"\u4F53\u529B +20",type:"value",valueKey:v.ps,value:20}},{price:15,good:{name:"\u8349\u5DE1",description:"\u653B\u51FB\u529B +30",type:"value",valueKey:p.attack,value:30}},{price:15,good:{name:"\u72D7\u9AA8",description:"\u9632\u5FA1\u529B +10",type:"value",valueKey:p.defense,value:10}},{price:20,good:{name:"\u6842\u6728",description:"\u653B\u51FB\u6B21\u6570 +1",type:"value",valueKey:p.attackSpeed,value:1}}],e.slice(2)}function bo(e){let t=1/0,o=1/0,s=-1/0,a=-1/0;for(const n of e)n.x>s&&(s=n.x),n.x<t&&(t=n.x),n.y>a&&(a=n.y),n.y<o&&(o=n.y);const u=s-t+1>=2&&a-o+1>=2;return{x:t,y:o,width:s-t+1,height:a-o+1,fits:new Set(e.map(n=>n.id)),isRoom:u,adjacent:new Set,id:e[0].id,status:F.mist,type:"blank"}}function ko(e=32){const t=[],o=i=>t[Math.floor(i/e)][i%e],s=new Set,a=[],u=({x:i,y:f},_,m)=>{var P;return((P=t[i+_])!=null?P:[])[f+m]},n=(i,f)=>([_,m])=>u({x:i,y:f},_,m),c=i=>({x:f,y:_})=>i.map(n(f,_)),A=[[[0,1]],[[0,-1]],[[1,0]],[[-1,0]],[[0,1],[0,2]],[[0,-1],[0,-2]],[[1,0],[2,0]],[[-1,0],[-2,0]],[[0,1],[0,2],[0,3]],[[0,-1],[0,-2],[0,-3]],[[1,0],[2,0],[3,0]],[[-1,0],[-2,0],[-3,0]]].map(c),h=[c([[1,0],[0,1],[1,1]]),c([[-1,0],[-1,1],[0,1]]),c([[-1,0],[-1,-1],[0,-1]]),c([[1,0],[1,-1],[0,-1]]),c([[1,0],[2,0],[2,-1],[1,-1],[0,-1]]),c([[-1,0],[-2,0],[-2,-1],[-1,-1],[0,-1]]),c([[0,1],[1,1],[2,1],[2,0],[1,0]]),c([[-1,0],[-2,0],[-2,1],[-1,1],[0,1]]),c([[1,0],[2,0],[2,-1],[1,-1],[0,-1],[0,-2],[1,-2],[2,-2]]),c([[-1,0],[-2,0],[-2,-1],[-1,-1],[0,-1],[0,-2],[-1,-2],[-2,-2],[]]),c([[0,1],[1,1],[2,1],[2,0],[1,0],[0,2],[1,2],[2,2]]),c([[-1,0],[-2,0],[-2,1],[-1,1],[0,1],[0,2],[-1,2],[-2,2]])];let x=0;for(let i=0;i<e;i++){t[i]=[];for(let f=0;f<e;f++)t[i][f]={x:i,y:f,id:x++}}const C=t.flat();for(let i=0;i<4*e;i++){const f=w(0,C.length-1),_=C[f];if(s.has(_))continue;s.add(_);const m=h.filter(S=>S(_).every(K=>K!==void 0&&!s.has(K)));if(m.length===0)continue;const V=m[w(0,m.length-1)](_);V.forEach(S=>s.add(S)),a.push([_].concat(V))}for(let i=0;i<e*e;i++){const f=w(0,C.length-1),_=C[f];if(s.has(_))continue;s.add(_);const m=A.filter(S=>S(_).every(K=>K!==void 0&&!s.has(K)));if(m.length===0)continue;const V=m[w(0,m.length-1)](_);V.forEach(S=>s.add(S)),a.push([_].concat(V))}const H=C.filter(i=>!s.has(i)).map(i=>[Math.abs(i.x-e/2)+Math.abs(i.y-e/2),i]).sort(([i],[f])=>i-f)[0][1],ae=I($({},H),{width:1,height:1,fits:new Set([H.id]),status:F.found,adjacent:new Set,isRoom:!0,type:"started"}),ie={};let O=a.map(bo).filter(i=>i.x!==0&&i.y!==0&&i.x+i.width!==e&&i.y+i.height!==e).filter(i=>!(Ao()&&i.fits.size<=4&&(i.width===1||i.height===1))).concat([ae]);O.forEach(i=>ie[i.id]=i);for(const i of O)for(const f of i.fits.values()){const _=[[0,1],[0,-1],[1,0],[-1,0]].map(n(o(f).x,o(f).y)).filter(Boolean);O.filter(m=>_.some(P=>m.fits.has(P.id)&&m!==i)).forEach(m=>i.adjacent.add(m.id))}const ee=new Set;function ue(i){ee.has(i)||(ee.add(i),i.adjacent.forEach(f=>ue(ie[f])))}return ue(ae),O=O.filter(i=>ee.has(i)),O}function wo(e=32){let t=[];for(;t.filter(o=>o.isRoom).length<e;)t=ko(e);return t}function So(e){e.forEach(t=>{const o=t;o.type="value",o.name="\u68EE",o.isNegate=!0,o.onlyValue=!0,o.value=w(1,6),o.valueKey=v.ps,o.description=`\u4E00\u7247\u68EE\u6797\u6321\u5728\u4E86\u4F60\u7684\u524D\u9762, \u6D88\u8017${o.value}\u70B9\u4F53\u529B, \u6467\u6BC1\u5B83`})}function Io(){const e=[],t={},o=wo(32);let s=[];const a=[];o.forEach(n=>{e.push(n.id),t[n.id]=n,n.isRoom&&n.type==="blank"?s.push(n):!n.isRoom&&n.type==="blank"&&a.push(n)}),s=$o(s);const u=Fe(Do);return s.forEach(n=>u()(n)),So(a),{regionIds:e,regions:t}}function ne(e){e.dungeon=Io()}function Ro(e,t){e.ui.offset=t.offset}function Oo(e,t){e.ui.activeRegionId=t.id}function Po(e){e.ui.showShop=!1}class Lo{constructor(){U(this,"injuryNumbers",new Set);U(this,"message",new Set);U(this,"cursor",[0,0])}addInjuryNumber(t){this.injuryNumbers.add(t),new le(t).to({opacity:.8,x:t.x+w(-30,30),y:t.y+w(-30,30)},400).easing(ce.Quadratic.InOut).onComplete(()=>{this.injuryNumbers.delete(t)}).start()}addInjuryNumberAtCursor(t){const[o,s]=this.cursor;this.addInjuryNumber({opacity:1,x:o,y:s,value:t})}addMessage(t){const o={msg:t,t:1};this.message.add(o),new le(o).to({t:0},1e3).easing(ce.Quadratic.InOut).onComplete(()=>{this.message.delete(o)}).start()}}const M=new Lo;function Mo(){const e=document.createElement("canvas");e.width=window.innerWidth,e.height=window.innerHeight,e.style.cssText=`
    top:0;
    left:0;
    position: fixed;
    pointer-events: none;
  `,document.body.appendChild(e);const t=n=>{M.cursor=[n.clientX,n.clientY]};window.addEventListener("pointerdown",t,{capture:!0}),window.addEventListener("pointermove",t,{capture:!0});const o=e.getContext("2d");function s(){M.injuryNumbers.forEach(n=>{const{value:c,opacity:A,x:h,y:x}=n,C=c.toString(),R=18;o.font=`${R}px Arial`,o.fillStyle=`rgba(255,0,0,${A})`;const{width:H}=o.measureText(C);o.fillText(C,h-H/2,x+R/2)})}function a(){M.message.forEach(n=>{const{msg:c,t:A}=n,h=24;o.font=`${h}px Arial`;const{width:x}=o.measureText(c),[C,R]=[window.innerWidth,window.innerHeight];o.fillStyle="rgba(0,0,0,0.5)",o.fillRect(0,(R-200-h+A*200)/2,C,h+8),o.fillStyle=`rgba(255,255,255,${A})`,o.fillText(c,(C-x)/2,(R+h-200+A*200)/2)})}function u(){we(),o.clearRect(0,0,e.width,e.height),s(),a(),requestAnimationFrame(u)}u()}const T=(e,t)=>{t.status===F.found&&(b.sound.click.currentTime=0,b.sound.click.play(),t.status=F.visited,t.adjacent.forEach(o=>{var a;const s=(a=e.dungeon)==null?void 0:a.regions[o];s&&s.status===F.mist&&(s.status=F.found)}))},me=(e,t)=>{if(!(t.status!==F.found||t.type!=="monster"&&t.type!=="boss")&&e.player){const o=e.player.values[p.attack].value-t.defense,s=t.attack-e.player.values[p.defense].value,a=e.player.values[p.attackSpeed].value;for(let u=0;u<a;u++)M.addInjuryNumberAtCursor(-Math.max(0,o)),setTimeout(()=>{b.monster.attacked.currentTime=0,b.monster.attacked.play()},8*u);t.hp[0]=Math.max(0,t.hp[0]-Math.max(0,o)*a),e.player.doubleValues[v.hp].value[0]=Math.max(0,e.player.doubleValues[v.hp].value[0]-Math.max(0,s)),t.hp[0]===0&&(e.player.values[p.soul].value+=t.soul,T(e,t),t.type==="boss"&&(t.status=F.found,t.type="chest",t.from="boss"))}},To=(e,t)=>{console.log("TODO: \u8FD9\u91CC\u5E94\u8BE5\u6709\u4E2A\u9009\u62E9\u5956\u52B1\u7684\u754C\u9762,\u9009\u62E9\u540E\u624D\u4F1A\u51FA\u73B0\u4F20\u9001\u9635"),T(e,t);const o=t;o.type="chanel",o.name="\u9635",o.status=F.found,o.description="\u4F20\u9001\u81F3\u4E0B\u4E00\u8F6E\u56DE"},jo=(e,t)=>{ne(e)},xo=(e,t)=>{ye(e,t)&&T(e,t)};function ye(e,t){var s,a;const o=t.isNegate?-1:1;if(Object.getOwnPropertySymbols((s=e.player)==null?void 0:s.doubleValues).indexOf(t.valueKey)!==-1){if(t.isNegate&&e.player.doubleValues[t.valueKey].value[0]<t.value){M.addMessage(`${e.player.doubleValues[t.valueKey].name} \u4E0D\u8DB3`);return}e.player.doubleValues[t.valueKey].value[0]=Math.min(e.player.doubleValues[t.valueKey].value[1],e.player.doubleValues[t.valueKey].value[0]+t.value*o)}return Object.getOwnPropertySymbols((a=e.player)==null?void 0:a.values).indexOf(t.valueKey)!==-1&&(e.player.values[t.valueKey].value=e.player.values[t.valueKey].value+t.value*o),!0}const Vo=(e,t)=>{const o=t;e.ui.activeShopRegionId=o.id,e.ui.showShop=!0,T(e,t),o.goods.some(s=>!s.sellOut)&&(o.status=F.found)},Ko={started:T,blank:T,monster:me,boss:me,chest:To,value:xo,chanel:jo,shop:Vo};function No(e,{id:t}){var s;const o=(s=e.dungeon)==null?void 0:s.regions[t];if(o&&o.status===F.found){Ko[o.type](e,o);return}}function Yo(e){var t;(t=e.dungeon)==null||t.regionIds.forEach(o=>{var a;const s=(a=e.dungeon)==null?void 0:a.regions[o];(s==null?void 0:s.status)===F.mist&&(s.status=F.found)})}function Xo(e){e.stage=D.roleSelect}function Ho(e){e.stage=D.title}function ge(e){e.stage=D.main}function Uo(e){e.stage=D.lose}function Go(e,t){e.player=Se(Co[t]),ne(e),ge(e)}function Wo(e){e.player&&(e.player.values[p.attack].value=1/0,e.player.values[p.defense].value=1/0)}function qo(e,t){const{good:o,region:s}=t;if(o.price>e.player.values[p.soul].value){M.addMessage("\u9B42\u4E0D\u8DB3");return}ye(e,o.good),e.player.values[p.soul].value-=o.price,o.sellOut=!0,s.goods.every(a=>a.sellOut)&&(s.status=F.visited)}var Qo=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",generateDungeon:ne,updateOffset:Ro,updateActiveRegionId:Oo,closeShop:Po,visitRegion:No,foundAllRegion:Yo,startGame:Xo,enterDungeon:ge,toLose:Uo,toTitle:Ho,selectHeroAndEnterDungeon:Go,invincible:Wo,buyFromShop:qo});const Jo={stage:D.title,ui:{offset:[0,0]}},j=Ie({state:Jo,mutations:Qo}),se={foundAllRegion:()=>j.commit("foundAllRegion"),invincible:()=>j.commit("invincible"),debug:()=>{se.foundAllRegion(),se.invincible()}};window._debugger=se;Mo();j.watch(e=>{var t,o;return(o=(t=e.player)==null?void 0:t.doubleValues[v.hp])==null?void 0:o.value[0]},e=>{e!==void 0&&e===0&&j.commit("toLose")});window.game=j;Re(Bo).use(j).mount("#game");
