var _e=Object.defineProperty,ye=Object.defineProperties;var Ee=Object.getOwnPropertyDescriptors;var re=Object.getOwnPropertySymbols;var ge=Object.prototype.hasOwnProperty,Ae=Object.prototype.propertyIsEnumerable;var q=(e,t,n)=>t in e?_e(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,w=(e,t)=>{for(var n in t||(t={}))ge.call(t,n)&&q(e,n,t[n]);if(re)for(var n of re(t))Ae.call(t,n)&&q(e,n,t[n]);return e},T=(e,t)=>ye(e,Ee(t));var H=(e,t,n)=>(q(e,typeof t!="symbol"?t+"":t,n),n);import{o as u,c,a as l,F as Q,r as J,n as Y,t as m,b as y,p as ue,d as le,e as E,m as Z,f as K,g as z,h as k,i as Be,u as X,j as U,k as Ce,T as ce,E as de,l as be,q as De,s as we}from"./vendor.9bc92774.js";const $e=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))s(a);new MutationObserver(a=>{for(const r of a)if(r.type==="childList")for(const o of r.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function n(a){const r={};return a.integrity&&(r.integrity=a.integrity),a.referrerpolicy&&(r.referrerPolicy=a.referrerpolicy),a.crossorigin==="use-credentials"?r.credentials="include":a.crossorigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function s(a){if(a.ep)return;a.ep=!0;const r=n(a);fetch(a.href,r)}};$e();var A;(function(e){e.title="title",e.roleSelect="roleSelect",e.main="main",e.lose="lose",e.clearance="clearance"})(A||(A={}));var v;(function(e){e.found="found",e.visited="visited",e.mist="mist"})(v||(v={}));const ke={locationUnit:32,regionGap:8,mistRegionColor:"#666",foundRegionColor:"#9d2"};function ee(e,t=!0,n=!0){if(e&&e.length>0){var s=t?18:15,a=n?13:9,r=pe(e)%s;t&&r>15&&(a=9);var o=pe(e)%a;return Re[o][r]}else console.log("Error: String not valid")}function pe(e){for(var t=5381,n=0;n<e.length;n++){var s=e.charCodeAt(n);t=(t<<5)+t+s}return Math.abs(t)}const Re=[["#FFEBEE","#FCE4EC","#F3E5F5","#EDE7F6","#E8EAF6","#E3F2FD","#E1F5FE","#E0F7FA","#E0F2F1","#E8F5E9","#F1F8E9","#F9FBE7","#FFFDE7","#FFF8E1","#FFF3E0","#FBE9E7","#EFEBE9","#FAFAFA","#ECEFF1"],["#FFCDD2","#F8BBD0","#E1BEE7","#D1C4E9","#C5CAE9","#BBDEFB","#B3E5FC","#B2EBF2","#B2DFDB","#C8E6C9","#DCEDC8","#F0F4C3","#FFF9C4","#FFECB3","#FFE0B2","#FFCCBC","#D7CCC8","#F5F5F5","#CFD8DC"],["#EF9A9A","#F48FB1","#CE93D8","#B39DDB","#9FA8DA","#90CAF9","#81D4FA","#80DEEA","#80CBC4","#A5D6A7","#C5E1A5","#E6EE9C","#FFF59D","#FFE082","#FFCC80","#FFAB91","#BCAAA4","#EEEEEE","#B0BEC5"],["#E57373","#F06292","#BA68C8","#9575CD","#7986CB","#64B5F6","#4FC3F7","#4DD0E1","#4DB6AC","#81C784","#AED581","#DCE775","#FFF176","#FFD54F","#FFB74D","#FF8A65","#A1887F","#E0E0E0","#90A4AE"],["#EF5350","#EC407A","#AB47BC","#7E57C2","#5C6BC0","#42A5F5","#29B6F6","#26C6DA","#26A69A","#66BB6A","#9CCC65","#D4E157","#FFEE58","#FFCA28","#FFA726","#FF7043","#8D6E63","#BDBDBD","#78909C"],["#F44336","#E91E63","#9C27B0","#673AB7","#3F51B5","#2196F3","#03A9F4","#00BCD4","#009688","#4CAF50","#8BC34A","#CDDC39","#FFEB3B","#FFC107","#FF9800","#FF5722","#795548","#9E9E9E","#607D8B"],["#E53935","#D81B60","#8E24AA","#5E35B1","#3949AB","#1E88E5","#039BE5","#00ACC1","#00897B","#43A047","#7CB342","#C0CA33","#FDD835","#FFB300","#FB8C00","#F4511E","#6D4C41","#757575","#546E7A"],["#D32F2F","#C2185B","#7B1FA2","#512DA8","#303F9F","#1976D2","#0288D1","#0097A7","#00796B","#388E3C","#689F38","#AFB42B","#FBC02D","#FFA000","#F57C00","#E64A19","#5D4037","#616161","#455A64"],["#C62828","#AD1457","#6A1B9A","#4527A0","#283593","#1565C0","#0277BD","#00838F","#00695C","#2E7D32","#558B2F","#9E9D24","#F9A825","#FF8F00","#EF6C00","#D84315","#4E342E","#424242","#37474F"],["#B71C1C","#880E4F","#4A148C","#311B92","#1A237E","#0D47A1","#01579B","#006064","#004D40","#1B5E20","#33691E","#827717","#F57F17","#FF6F00","#E65100","#BF360C","#3E2723","#212121","#263238"],["#FF8A80","#FF80AB","#EA80FC","#B388FF","#8C9EFF","#82B1FF","#80D8FF","#84FFFF","#A7FFEB","#B9F6CA","#CCFF90","#F4FF81","#FFFF8D","#FFE57F","#FFD180","#FF9E80"],["#FF5252","#FF4081","#E040FB","#7C4DFF","#536DFE","#448AFF","#40C4FF","#18FFFF","#64FFDA","#69F0AE","#B2FF59","#EEFF41","#FFFF00","#FFD740","#FFAB40","#FF6E40"],["#FF1744","#F50057","#D500F9","#651FFF","#3D5AFE","#2979FF","#00B0FF","#00E5FF","#1DE9B6","#00E676","#76FF03","#C6FF00","#FFEA00","#FFC400","#FF9100","#FF3D00"],["#D50000","#C51162","#AA00FF","#6200EA","#304FFE","#2962FF","#0091EA","#00B8D4","#00BFA5","#00C853","#64DD17","#AEEA00","#FFD600","#FFAB00","#FF6D00","#DD2C00"]],fe=e=>(ue("data-v-84122b20"),e=e(),le(),e),Se=["onPointerenter","onPointerdown"],Ie={key:0,class:"monster"},Pe={class:"name"},Oe={class:"hp"},xe={key:1,class:"monster boss"},Le={class:"name"},Te={class:"hp"},je={key:2,class:"value"},Me={key:0,class:"name"},Ve={key:1,class:"name"},Ne={key:3,class:"value"},He=fe(()=>l("div",{class:"name"},"\u59CB",-1)),Ye=[He],Ke={key:4,class:"value"},Xe=fe(()=>l("div",{class:"name"},"\u5B9D",-1)),Ue=[Xe],Ge={key:5,class:"value"},We={class:"name"};function qe(e,t,n,s,a,r){return u(),c("div",{class:"dungeon-container",onPointerdown:t[2]||(t[2]=(...o)=>e.pointerdown&&e.pointerdown(...o)),onPointerup:t[3]||(t[3]=(...o)=>e.pointerup&&e.pointerup(...o)),onPointermove:t[4]||(t[4]=(...o)=>e.pointermove&&e.pointermove(...o))},[l("div",{class:"dungeon",style:Y({top:e.offsetY+"px",left:e.offsetX+"px"})},[(u(!0),c(Q,null,J(e.reginList,o=>(u(),c("div",{class:"region",style:Y(e.makeRegionStyle(o)),onPointerleave:t[0]||(t[0]=(...d)=>e.regionPointerLeave&&e.regionPointerLeave(...d)),onPointerenter:d=>e.regionPointerEnter(o),onPointerdown:d=>e.regionPointerDown(o.id),onPointerup:t[1]||(t[1]=(...d)=>e.regionPointerUp&&e.regionPointerUp(...d))},[o.type==="monster"&&o.status!=="mist"?(u(),c("div",Ie,[l("div",Pe,m(o.name),1),l("div",Oe,"("+m(o.hp[0])+"/"+m(o.hp[1])+")",1)])):y("",!0),o.type==="boss"&&o.status!=="mist"?(u(),c("div",xe,[l("div",Le,m(o.name),1),l("div",Te,"("+m(o.hp[0])+"/"+m(o.hp[1])+")",1)])):y("",!0),o.type==="value"&&o.status!=="mist"?(u(),c("div",je,[o.onlyValue?(u(),c("div",Ve,m(o.value),1)):(u(),c("div",Me,m(o.name),1))])):y("",!0),o.type==="started"&&o.status!=="mist"?(u(),c("div",Ne,Ye)):y("",!0),o.type==="chest"&&o.status!=="mist"?(u(),c("div",Ke,Ue)):y("",!0),o.type==="chanel"&&o.status!=="mist"?(u(),c("div",Ge,[l("div",We,m(o.name),1)])):y("",!0)],44,Se))),256))],4)],32)}var B=(e,t)=>{const n=e.__vccOpts||e;for(const[s,a]of t)n[s]=a;return n};const{locationUnit:G,foundRegionColor:Qe,mistRegionColor:Je,regionGap:Fe}=ke,Ze=E({data(){return{downX:-1,downY:-1,nowOffsetX:0,nowOffsetY:0,timeoutHandler:null,intervalHandler:null}},computed:Z({offsetX:e=>e.ui.offset[0],offsetY:e=>e.ui.offset[1],reginList:e=>{var t;return(t=e.dungeon)==null?void 0:t.regionIds.map(n=>{var s;return(s=e.dungeon)==null?void 0:s.regions[n]})}}),unmounted(){this.regionPointerUp()},methods:T(w({},K(["updateOffset","visitRegion","updateActiveRegionId"])),{makeRegionStyle(e){let t={};return e.status===v.mist&&(t.backgroundColor=Je),(e.status===v.found||e.status===v.visited)&&(Object.keys(e).indexOf("name")!==-1?(t.color=ee(e.name+"-font-color",!1,!1),t.backgroundColor=ee(e.name,!1)):t.backgroundColor=Qe),e.status===v.visited&&(t.opacity=.6),w({width:e.width*G-Fe+"px",height:e.height*G-Fe+"px",left:e.x*G+"px",top:e.y*G+"px"},t)},pointerdown(e){this.downX=e.x,this.downY=e.y,this.nowOffsetX=this.offsetX,this.nowOffsetY=this.offsetY},pointermove(e){if(this.downX!==-1&&this.downY!==-1){let t=e.x-this.downX+this.nowOffsetX,n=e.y-this.downY+this.nowOffsetY;this.updateOffset({offset:[t,n]})}},pointerup(){this.downX=-1,this.downY=-1},regionPointerDown(e){this.visitRegion({id:e}),this.timeoutHandler=setTimeout(()=>{this.intervalHandler=setInterval(()=>{this.visitRegion({id:e})},100)},200)},regionPointerUp(){this.timeoutHandler&&clearTimeout(this.timeoutHandler),this.intervalHandler&&clearInterval(this.intervalHandler)},regionPointerEnter(e){e.status===v.found&&this.updateActiveRegionId({id:e.id})},regionPointerLeave(){this.updateActiveRegionId({id:null})}})});var ze=B(Ze,[["render",qe],["__scopeId","data-v-84122b20"]]);function et(e,t,n,s,a,r){return u(),c("div",{class:"icon",style:Y(e.style)},null,4)}const tt=E({props:["type"],computed:{style(){return{backgroundImage:`url(icons/${this.type}.png)`,width:"16px",height:"16px",backgroundSize:"100% 100%"}}}});var nt=B(tt,[["render",et]]);const ot={class:"double-bar"},st={class:"value"};function at(e,t,n,s,a,r){return u(),c("div",ot,[l("div",{class:"fill",style:Y({"background-color":e.color,left:`-${(1-e.percentage)*100}%`})},null,4),l("div",st,m(e.value),1)])}const it=E({props:["color","value","percentage"]});var rt=B(it,[["render",at],["__scopeId","data-v-39186694"]]);const ut={key:0,class:"region-panel"},lt={key:0,class:"panel"},ct=l("div",{class:"content"},"\u70B9\u51FB\u5F00\u59CB\u63A2\u7D22",-1),dt=[ct],pt={key:1,class:"panel"},ft={class:"content"};function Ft(e,t,n,s,a,r){return e.region?(u(),c("div",ut,[e.region.type==="started"?(u(),c("div",lt,dt)):y("",!0),e.region.type==="value"||e.region.type==="monster"||e.region.type==="boss"||e.region.type==="chanel"?(u(),c("div",pt,[l("div",ft,m(e.region.name)+": "+m(e.region.description),1)])):y("",!0)])):y("",!0)}const vt=E({props:["region"]});var ht=B(vt,[["render",Ft]]);const mt={class:"player-panel"},_t={class:"player-header"},yt={class:"avatar"},Et={class:"values-panel"},gt=["title"],At={class:"icon"},Bt=["title"],Ct={class:"icon"},bt={class:"value"},Dt={class:"tool-tip"};function wt(e,t,n,s,a,r){const o=z("icon"),d=z("DoubleBar"),b=z("RegionInfo");return u(),c("div",mt,[l("div",_t,[l("div",yt,m(e.avatar),1),l("div",Et,[(u(!0),c(Q,null,J(e.doubleValues,f=>(u(),c("div",{class:"values",title:f.name},[l("span",At,[k(o,{type:f.icon},null,8,["type"])]),k(d,{color:e.getColorFromString(f.name+"10"),value:`${f.value[0]}/${f.value[1]}`,percentage:f.value[0]/f.value[1]},null,8,["color","value","percentage"])],8,gt))),256)),(u(!0),c(Q,null,J(e.values,f=>(u(),c("div",{class:"values",title:f.name},[l("span",Ct,[k(o,{type:f.icon},null,8,["type"])]),l("span",bt,m(f.value),1)],8,Bt))),256))])]),l("div",Dt,[k(b,{region:e.activeRegion},null,8,["region"])])])}const $t=E({components:{icon:nt,DoubleBar:rt,RegionInfo:ht},methods:{getColorFromString:ee},computed:Z({doubleValues:e=>Object.getOwnPropertySymbols(e.player.doubleValues).map(t=>e.player.doubleValues[t]).sort((t,n)=>t.order-n.order),values:e=>Object.getOwnPropertySymbols(e.player.values).map(t=>e.player.values[t]).sort((t,n)=>t.order-n.order),avatar:e=>e.player.avatar,activeRegion:e=>{var t;return(t=e.dungeon)==null?void 0:t.regions[e.ui.activeRegionId]}})});var kt=B($t,[["render",wt],["__scopeId","data-v-18a3fc5a"]]);const Rt={class:"ui"},St={class:"top"},It=E({setup(e){return(t,n)=>(u(),c("div",Rt,[l("div",St,[k(kt)])]))}});var Pt=B(It,[["__scopeId","data-v-4c1b6bfc"]]);const Ot={class:"main"},xt=E({setup(e){return(t,n)=>(u(),c("div",Ot,[k(ze),k(Pt)]))}}),j={monster:{attacked:new Audio("./monster/attacked.mp3")},bgm:{mountain_ghost:new Audio("./bgm/mountain_ghost.mp3")}},Lt={class:"title"},Tt=l("div",{class:"brand"},null,-1);function jt(e,t,n,s,a,r){return u(),c("div",Lt,[Tt,l("div",{class:"start-btn",onClick:t[0]||(t[0]=o=>e.start())},"\u620F\u4F5C")])}const Mt=E({methods:T(w({},K(["startGame"])),{start(){j.bgm.mountain_ghost.play(),j.bgm.mountain_ghost.addEventListener("ended",()=>{j.bgm.mountain_ghost.play()}),this.startGame()}})});var Vt=B(Mt,[["render",jt]]);const Nt=e=>(ue("data-v-d4dedccc"),e=e(),le(),e),Ht={class:"container"},Yt=Nt(()=>l("p",null,"\u62E9\u5176\u4E4B\u4E00",-1)),Kt={class:"row"},Xt=Be('<span class="disable" data-v-d4dedccc>\u5175</span><span class="disable" data-v-d4dedccc>\u6597</span><span class="disable" data-v-d4dedccc>\u8005</span><span class="disable" data-v-d4dedccc>\u7686</span><span class="disable" data-v-d4dedccc>\u9635</span><span class="disable" data-v-d4dedccc>\u5217</span><span class="disable" data-v-d4dedccc>\u524D</span><span class="disable" data-v-d4dedccc>\u884C</span>',8);function Ut(e,t,n,s,a,r){return u(),c("div",Ht,[Yt,l("div",Kt,[l("span",{onClick:t[0]||(t[0]=o=>e.selectHeroAndEnterDungeon(0))},"\u4E34"),Xt])])}const Gt=E({methods:w({},K(["selectHeroAndEnterDungeon"]))});var Wt=B(Gt,[["render",Ut],["__scopeId","data-v-d4dedccc"]]);const qt={class:"title"},Qt=l("div",{class:"brand"},null,-1),Jt=l("div",{class:"start-btn"},"Game Over",-1);function Zt(e,t,n,s,a,r){return u(),c("div",qt,[Qt,Jt,l("div",{class:"restart",onClick:t[0]||(t[0]=(...o)=>e.toTitle&&e.toTitle(...o))},"\u91CD\u65B0\u5F00\u59CB")])}const zt=E({methods:w({},K(["toTitle"]))});var en=B(zt,[["render",Zt]]);const tn={class:"container"},nn=E({computed:Z(["stage"]),mounted(){}}),on=E(T(w({},nn),{setup(e){return(t,n)=>(u(),c("div",tn,[t.stage===X(A).main?(u(),U(xt,{key:0})):y("",!0),t.stage===X(A).title?(u(),U(Vt,{key:1})):y("",!0),t.stage===X(A).roleSelect?(u(),U(Wt,{key:2})):y("",!0),t.stage===X(A).lose?(u(),U(en,{key:3})):y("",!0)]))}}));var sn=B(on,[["__scopeId","data-v-bcb0536e"]]);function D(e,t){return Math.round(Math.random()*(t-e)+e)}function an(e=.5){return Math.random()>e}function rn(e){const t=e.reduce((s,[a,r])=>s+r,0),n=e.sort(([s,a],[r,o])=>o-a);return()=>{const s=D(0,t);let a=0;for(const[r,o]of n)if(a+=o,a>=s)return r;throw new Error}}const te=[{weight:1,factory:()=>({name:"\u9E21",hp:[10,10],attack:12,defense:5,description:"\u653B: 12 \u9632: 5 \u8D4F: 10\u6587 1\u9B42"})},{weight:1,factory:()=>({name:"\u72AC",hp:[16,16],attack:20,defense:2,description:"\u653B: 20 \u9632: 2 \u8D4F: 13\u6587 2\u9B42"})}];te.sort((e,t)=>e.weight-t.weight);const C={attack:Symbol("attack"),defense:Symbol("defense")},_={hp:Symbol("hp"),mp:Symbol("mp"),ps:Symbol("ps"),rage:Symbol("rage")},un=[{avatar:"\u4E34",doubleValues:{[_.hp]:{key:_.hp,name:"HP",value:[100,100],order:1,icon:"ui_hp"},[_.mp]:{key:_.mp,name:"MP",value:[60,60],order:2,icon:"ui_mp"},[_.ps]:{key:_.ps,name:"PS",value:[120,120],order:3,icon:"ui_ps"},[_.rage]:{key:_.rage,name:"\u6012",value:[0,100],order:4,icon:"ui_rage"}},values:{[C.attack]:{key:C.attack,name:"\u653B\u51FB\u529B",value:7,order:5,icon:"ui_attack"},[C.defense]:{key:C.defense,name:"\u9632\u5FA1\u529B",value:6,order:6,icon:"ui_defense"}}}],ln=te.reduce((e,t)=>e+t.weight,0);function cn(){const e=D(1,ln);let t=0;for(const n of te.reverse())if(t-=n.weight,t<e)return n;throw new Error}const dn=[[e=>{e.type="monster",Object.assign(e,cn().factory())},4],[e=>{e.type="value";const t=e;t.name="\u6CC9",t.value=10,t.description="HP +10",t.valueKey=_.hp},1],[e=>{e.type="value";const t=e;t.name="\u795D",t.value=3,t.description="\u653B\u51FB\u529B +3",t.valueKey=C.attack},1],[e=>{e.type="value";const t=e;t.name="\u7532",t.value=4,t.description="\u9632\u5FA1\u529B +4",t.valueKey=C.defense},1],[e=>{e.type="value";const t=e;t.name="\u7A74",t.value=10,t.description="PS +10",t.valueKey=_.ps},1]],pn=rn(dn);function fn(e){e.isRoom&&e.type==="blank"&&pn()(e)}const ve=[{weight:1,factory:()=>({name:"\u72D0",hp:[100,100],attack:32,defense:13,description:"\u653B: 32 \u9632: 13"})}];ve.sort((e,t)=>e.weight-t.weight);function Fn(e){let t=1/0,n=1/0,s=-1/0,a=-1/0;for(const o of e)o.x>s&&(s=o.x),o.x<t&&(t=o.x),o.y>a&&(a=o.y),o.y<n&&(n=o.y);const r=s-t+1>=2&&a-n+1>=2;return{x:t,y:n,width:s-t+1,height:a-n+1,fits:new Set(e.map(o=>o.id)),isRoom:r,adjacent:new Set,id:e[0].id,status:v.mist,type:"blank"}}function vn(e=32){const t=[],n=i=>t[Math.floor(i/e)][i%e],s=new Set,a=[],r=({x:i,y:p},F,h)=>{var I;return((I=t[i+F])!=null?I:[])[p+h]},o=(i,p)=>([F,h])=>r({x:i,y:p},F,h),d=i=>({x:p,y:F})=>i.map(o(p,F)),b=[[[0,1]],[[0,-1]],[[1,0]],[[-1,0]],[[0,1],[0,2]],[[0,-1],[0,-2]],[[1,0],[2,0]],[[-1,0],[-2,0]],[[0,1],[0,2],[0,3]],[[0,-1],[0,-2],[0,-3]],[[1,0],[2,0],[3,0]],[[-1,0],[-2,0],[-3,0]]].map(d),f=[d([[1,0],[0,1],[1,1]]),d([[-1,0],[-1,1],[0,1]]),d([[-1,0],[-1,-1],[0,-1]]),d([[1,0],[1,-1],[0,-1]]),d([[1,0],[2,0],[2,-1],[1,-1],[0,-1]]),d([[-1,0],[-2,0],[-2,-1],[-1,-1],[0,-1]]),d([[0,1],[1,1],[2,1],[2,0],[1,0]]),d([[-1,0],[-2,0],[-2,1],[-1,1],[0,1]]),d([[1,0],[2,0],[2,-1],[1,-1],[0,-1],[0,-2],[1,-2],[2,-2]]),d([[-1,0],[-2,0],[-2,-1],[-1,-1],[0,-1],[0,-2],[-1,-2],[-2,-2],[]]),d([[0,1],[1,1],[2,1],[2,0],[1,0],[0,2],[1,2],[2,2]]),d([[-1,0],[-2,0],[-2,1],[-1,1],[0,1],[0,2],[-1,2],[-2,2]])];let O=0;for(let i=0;i<e;i++){t[i]=[];for(let p=0;p<e;p++)t[i][p]={x:i,y:p,id:O++}}const g=t.flat();for(let i=0;i<4*e;i++){const p=D(0,g.length-1),F=g[p];if(s.has(F))continue;s.add(F);const h=f.filter($=>$(F).every(L=>L!==void 0&&!s.has(L)));if(h.length===0)continue;const x=h[D(0,h.length-1)](F);x.forEach($=>s.add($)),a.push([F].concat(x))}for(let i=0;i<e*e;i++){const p=D(0,g.length-1),F=g[p];if(s.has(F))continue;s.add(F);const h=b.filter($=>$(F).every(L=>L!==void 0&&!s.has(L)));if(h.length===0)continue;const x=h[D(0,h.length-1)](F);x.forEach($=>s.add($)),a.push([F].concat(x))}const N=g.filter(i=>!s.has(i)).map(i=>[Math.abs(i.x-e/2)+Math.abs(i.y-e/2),i]).sort(([i],[p])=>i-p)[0][1],se=T(w({},N),{width:1,height:1,fits:new Set([N.id]),status:v.found,adjacent:new Set,isRoom:!0,type:"started"}),ae={};let S=a.map(Fn).filter(i=>i.x!==0&&i.y!==0&&i.x+i.width!==e&&i.y+i.height!==e).filter(i=>!(an()&&i.fits.size<=4&&(i.width===1||i.height===1))).concat([se]);S.forEach(i=>ae[i.id]=i);for(const i of S)for(const p of i.fits.values()){const F=[[0,1],[0,-1],[1,0],[-1,0]].map(o(n(p).x,n(p).y)).filter(Boolean);S.filter(h=>F.some(I=>h.fits.has(I.id)&&h!==i)).forEach(h=>i.adjacent.add(h.id))}const W=new Set;function ie(i){W.has(i)||(W.add(i),i.adjacent.forEach(p=>ie(ae[p])))}return ie(se),S=S.filter(i=>W.has(i)),S}function hn(e=32){let t=[];for(;t.filter(n=>n.isRoom).length<e;)t=vn(e);return t}function mn(e){e[0].type="boss";const t=e[0],{defense:n,attack:s,hp:a,name:r,description:o}=ve[0].factory();t.attack=s,t.defense=n,t.hp=a,t.name=r,t.description=o,e.forEach(fn)}function _n(e){e.forEach(t=>{const n=t;n.type="value",n.name="\u68EE",n.isNegate=!0,n.onlyValue=!0,n.value=D(1,6),n.valueKey=_.ps,n.description=`\u4E00\u7247\u68EE\u6797\u6321\u5728\u4E86\u4F60\u7684\u524D\u9762, \u6D88\u8017${n.value}\u70B9\u4F53\u529B, \u6467\u6BC1\u5B83`})}function ne(e){const t=[],n={},s=hn(32),a=[],r=[];s.forEach(o=>{t.push(o.id),n[o.id]=o,o.isRoom&&o.type==="blank"?a.push(o):!o.isRoom&&o.type==="blank"&&r.push(o)}),mn(a),_n(r),e.dungeon={regionIds:t,regions:n}}function yn(e,t){e.ui.offset=t.offset}function En(e,t){e.ui.activeRegionId=t.id}class gn{constructor(){H(this,"injuryNumbers",new Set);H(this,"message",new Set);H(this,"cursor",[0,0])}addInjuryNumber(t){this.injuryNumbers.add(t),new ce(t).to({opacity:.8,x:t.x+D(-30,30),y:t.y+D(-30,30)},400).easing(de.Quadratic.InOut).onComplete(()=>{this.injuryNumbers.delete(t)}).start()}addInjuryNumberAtCursor(t){const[n,s]=this.cursor;this.addInjuryNumber({opacity:1,x:n,y:s,value:t})}addMessage(t){const n={msg:t,t:1};this.message.add(n),new ce(n).to({t:0},1e3).easing(de.Quadratic.InOut).onComplete(()=>{this.message.delete(n)}).start()}}const M=new gn;function An(){const e=document.createElement("canvas");e.width=window.innerWidth,e.height=window.innerHeight,e.style.cssText=`
    top:0;
    left:0;
    position: fixed;
    pointer-events: none;
  `,document.body.appendChild(e);const t=o=>{M.cursor=[o.clientX,o.clientY]};window.addEventListener("pointerdown",t,{capture:!0}),window.addEventListener("pointermove",t,{capture:!0});const n=e.getContext("2d");function s(){M.injuryNumbers.forEach(o=>{const{value:d,opacity:b,x:f,y:O}=o,g=d.toString(),R=18;n.font=`${R}px Arial`,n.fillStyle=`rgba(255,0,0,${b})`;const{width:N}=n.measureText(g);n.fillText(g,f-N/2,O+R/2)})}function a(){M.message.forEach(o=>{const{msg:d,t:b}=o,f=24;n.font=`${f}px Arial`;const{width:O}=n.measureText(d),[g,R]=[window.innerWidth,window.innerHeight];n.fillStyle="rgba(0,0,0,0.5)",n.fillRect(0,(R-200-f+b*200)/2,g,f+8),n.fillStyle=`rgba(255,255,255,${b})`,n.fillText(d,(g-O)/2,(R+f-200+b*200)/2)})}function r(){Ce(),n.clearRect(0,0,e.width,e.height),s(),a(),requestAnimationFrame(r)}r()}const V=(e,t)=>{t.status===v.found&&(t.status=v.visited,t.adjacent.forEach(n=>{var a;const s=(a=e.dungeon)==null?void 0:a.regions[n];s&&s.status===v.mist&&(s.status=v.found)}))},he=(e,t)=>{if(!(t.status!==v.found||t.type!=="monster"&&t.type!=="boss")&&e.player){e.player.values;const n=e.player.values[C.attack].value-t.defense,s=t.attack-e.player.values[C.defense].value;M.addInjuryNumberAtCursor(-Math.max(0,n)),t.hp[0]=Math.max(0,t.hp[0]-Math.max(0,n)),e.player.doubleValues[_.hp].value[0]=Math.max(0,e.player.doubleValues[_.hp].value[0]-Math.max(0,s)),j.monster.attacked.currentTime=0,j.monster.attacked.play(),t.hp[0]===0&&(V(e,t),t.type==="boss"&&(t.status=v.found,t.type="chest",t.from="boss"))}},Bn=(e,t)=>{console.log("TODO: \u8FD9\u91CC\u5E94\u8BE5\u6709\u4E2A\u9009\u62E9\u5956\u52B1\u7684\u754C\u9762,\u9009\u62E9\u540E\u624D\u4F1A\u51FA\u73B0\u4F20\u9001\u9635"),V(e,t);const n=t;n.type="chanel",n.name="\u9635",n.status=v.found,n.description="\u4F20\u9001\u81F3\u4E0B\u4E00\u8F6E\u56DE"},Cn=(e,t)=>{ne(e)},bn=(e,t)=>{var a,r;const n=t,s=n.isNegate?-1:1;if(Object.getOwnPropertySymbols((a=e.player)==null?void 0:a.doubleValues).indexOf(n.valueKey)!==-1){if(n.isNegate&&e.player.doubleValues[n.valueKey].value[0]<n.value){M.addMessage(`${e.player.doubleValues[n.valueKey].name} \u4E0D\u8DB3`);return}e.player.doubleValues[n.valueKey].value[0]=Math.min(e.player.doubleValues[n.valueKey].value[1],e.player.doubleValues[n.valueKey].value[0]+n.value*s)}Object.getOwnPropertySymbols((r=e.player)==null?void 0:r.values).indexOf(n.valueKey)!==-1&&(e.player.values[n.valueKey].value=e.player.values[n.valueKey].value+n.value*s),V(e,t)},Dn={started:V,blank:V,monster:he,boss:he,chest:Bn,value:bn,chanel:Cn};function wn(e,{id:t}){var s;const n=(s=e.dungeon)==null?void 0:s.regions[t];if(n&&n.status===v.found){Dn[n.type](e,n);return}}function $n(e){var t;(t=e.dungeon)==null||t.regionIds.forEach(n=>{var a;const s=(a=e.dungeon)==null?void 0:a.regions[n];(s==null?void 0:s.status)===v.mist&&(s.status=v.found)})}function kn(e){e.stage=A.roleSelect}function Rn(e){e.stage=A.title}function me(e){e.stage=A.main}function Sn(e){e.stage=A.lose}function In(e,t){e.player=be(un[t]),ne(e),me(e)}function Pn(e){e.player&&(e.player.values[C.attack].value=1/0,e.player.values[C.defense].value=1/0)}var On=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",generateDungeon:ne,updateOffset:yn,updateActiveRegionId:En,visitRegion:wn,foundAllRegion:$n,startGame:kn,enterDungeon:me,toLose:Sn,toTitle:Rn,selectHeroAndEnterDungeon:In,invincible:Pn});const xn={stage:A.title,ui:{offset:[0,0]}},P=De({state:xn,mutations:On}),oe={foundAllRegion:()=>P.commit("foundAllRegion"),invincible:()=>P.commit("invincible"),debug:()=>{oe.foundAllRegion(),oe.invincible()}};window._debugger=oe;An();P.watch(e=>{var t,n;return(n=(t=e.player)==null?void 0:t.doubleValues[_.hp])==null?void 0:n.value[0]},e=>{e!==void 0&&e===0&&P.commit("toLose")});window.game=P;we(sn).use(P).mount("#game");
