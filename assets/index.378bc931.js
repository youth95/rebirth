var ce=Object.defineProperty,ue=Object.defineProperties;var Fe=Object.getOwnPropertyDescriptors;var te=Object.getOwnPropertySymbols;var fe=Object.prototype.hasOwnProperty,pe=Object.prototype.propertyIsEnumerable;var N=(e,t,n)=>t in e?ce(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,y=(e,t)=>{for(var n in t||(t={}))fe.call(t,n)&&N(e,n,t[n]);if(te)for(var n of te(t))pe.call(t,n)&&N(e,n,t[n]);return e},O=(e,t)=>ue(e,Fe(t));var X=(e,t,n)=>(N(e,typeof t!="symbol"?t+"":t,n),n);import{o as d,c as p,a as F,F as H,r as U,n as ne,t as m,b as w,d as v,m as G,e as P,f as K,p as oe,g as se,u as he,h as Ee,i as me,j as I,k as L,l as ve,T as _e,E as ye,q as Ce,s as Ae,v as ge}from"./vendor.3b61c22d.js";const Be=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))o(r);new MutationObserver(r=>{for(const i of r)if(i.type==="childList")for(const a of i.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&o(a)}).observe(document,{childList:!0,subtree:!0});function n(r){const i={};return r.integrity&&(i.integrity=r.integrity),r.referrerpolicy&&(i.referrerPolicy=r.referrerpolicy),r.crossorigin==="use-credentials"?i.credentials="include":r.crossorigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function o(r){if(r.ep)return;r.ep=!0;const i=n(r);fetch(r.href,i)}};Be();var E;(function(e){e.title="title",e.roleSelect="roleSelect",e.main="main",e.lose="lose",e.clearance="clearance"})(E||(E={}));var h;(function(e){e.found="found",e.visited="visited",e.mist="mist"})(h||(h={}));const De={locationUnit:32,regionGap:8,mistRegionColor:"#666",foundRegionColor:"#9d2"};function ae(e,t=!0,n=!0){if(e&&e.length>0){var o=t?18:15,r=n?13:9,i=re(e)%o;t&&i>15&&(r=9);var a=re(e)%r;return we[a][i]}else console.log("Error: String not valid")}function re(e){for(var t=5381,n=0;n<e.length;n++){var o=e.charCodeAt(n);t=(t<<5)+t+o}return Math.abs(t)}const we=[["#FFEBEE","#FCE4EC","#F3E5F5","#EDE7F6","#E8EAF6","#E3F2FD","#E1F5FE","#E0F7FA","#E0F2F1","#E8F5E9","#F1F8E9","#F9FBE7","#FFFDE7","#FFF8E1","#FFF3E0","#FBE9E7","#EFEBE9","#FAFAFA","#ECEFF1"],["#FFCDD2","#F8BBD0","#E1BEE7","#D1C4E9","#C5CAE9","#BBDEFB","#B3E5FC","#B2EBF2","#B2DFDB","#C8E6C9","#DCEDC8","#F0F4C3","#FFF9C4","#FFECB3","#FFE0B2","#FFCCBC","#D7CCC8","#F5F5F5","#CFD8DC"],["#EF9A9A","#F48FB1","#CE93D8","#B39DDB","#9FA8DA","#90CAF9","#81D4FA","#80DEEA","#80CBC4","#A5D6A7","#C5E1A5","#E6EE9C","#FFF59D","#FFE082","#FFCC80","#FFAB91","#BCAAA4","#EEEEEE","#B0BEC5"],["#E57373","#F06292","#BA68C8","#9575CD","#7986CB","#64B5F6","#4FC3F7","#4DD0E1","#4DB6AC","#81C784","#AED581","#DCE775","#FFF176","#FFD54F","#FFB74D","#FF8A65","#A1887F","#E0E0E0","#90A4AE"],["#EF5350","#EC407A","#AB47BC","#7E57C2","#5C6BC0","#42A5F5","#29B6F6","#26C6DA","#26A69A","#66BB6A","#9CCC65","#D4E157","#FFEE58","#FFCA28","#FFA726","#FF7043","#8D6E63","#BDBDBD","#78909C"],["#F44336","#E91E63","#9C27B0","#673AB7","#3F51B5","#2196F3","#03A9F4","#00BCD4","#009688","#4CAF50","#8BC34A","#CDDC39","#FFEB3B","#FFC107","#FF9800","#FF5722","#795548","#9E9E9E","#607D8B"],["#E53935","#D81B60","#8E24AA","#5E35B1","#3949AB","#1E88E5","#039BE5","#00ACC1","#00897B","#43A047","#7CB342","#C0CA33","#FDD835","#FFB300","#FB8C00","#F4511E","#6D4C41","#757575","#546E7A"],["#D32F2F","#C2185B","#7B1FA2","#512DA8","#303F9F","#1976D2","#0288D1","#0097A7","#00796B","#388E3C","#689F38","#AFB42B","#FBC02D","#FFA000","#F57C00","#E64A19","#5D4037","#616161","#455A64"],["#C62828","#AD1457","#6A1B9A","#4527A0","#283593","#1565C0","#0277BD","#00838F","#00695C","#2E7D32","#558B2F","#9E9D24","#F9A825","#FF8F00","#EF6C00","#D84315","#4E342E","#424242","#37474F"],["#B71C1C","#880E4F","#4A148C","#311B92","#1A237E","#0D47A1","#01579B","#006064","#004D40","#1B5E20","#33691E","#827717","#F57F17","#FF6F00","#E65100","#BF360C","#3E2723","#212121","#263238"],["#FF8A80","#FF80AB","#EA80FC","#B388FF","#8C9EFF","#82B1FF","#80D8FF","#84FFFF","#A7FFEB","#B9F6CA","#CCFF90","#F4FF81","#FFFF8D","#FFE57F","#FFD180","#FF9E80"],["#FF5252","#FF4081","#E040FB","#7C4DFF","#536DFE","#448AFF","#40C4FF","#18FFFF","#64FFDA","#69F0AE","#B2FF59","#EEFF41","#FFFF00","#FFD740","#FFAB40","#FF6E40"],["#FF1744","#F50057","#D500F9","#651FFF","#3D5AFE","#2979FF","#00B0FF","#00E5FF","#1DE9B6","#00E676","#76FF03","#C6FF00","#FFEA00","#FFC400","#FF9100","#FF3D00"],["#D50000","#C51162","#AA00FF","#6200EA","#304FFE","#2962FF","#0091EA","#00B8D4","#00BFA5","#00C853","#64DD17","#AEEA00","#FFD600","#FFAB00","#FF6D00","#DD2C00"]],be=["onPointerdown"],$e={key:0,class:"monster"},ke={class:"name"},Se={class:"hp"},xe={key:1,class:"value"},Re={class:"name"};function Oe(e,t,n,o,r,i){return d(),p("div",{class:"dungeon-container",onPointerdown:t[1]||(t[1]=(...a)=>e.pointerdown&&e.pointerdown(...a)),onPointerup:t[2]||(t[2]=(...a)=>e.pointerup&&e.pointerup(...a)),onPointermove:t[3]||(t[3]=(...a)=>e.pointermove&&e.pointermove(...a))},[F("div",{class:"dungeon",style:ne({top:e.offsetY+"px",left:e.offsetX+"px"})},[(d(!0),p(H,null,U(e.reginList,a=>(d(),p("div",{class:"region",style:ne(e.makeRegionStyle(a)),onPointerdown:u=>e.regionPointerDown(a.id),onPointerup:t[0]||(t[0]=(...u)=>e.regionPointerUp&&e.regionPointerUp(...u))},[a.type==="monster"&&a.status!=="mist"?(d(),p("div",$e,[F("div",ke,m(a.name),1),F("div",Se,"("+m(a.hp[0])+"/"+m(a.hp[1])+")",1)])):w("",!0),a.type==="value"&&a.status!=="mist"?(d(),p("div",xe,[F("div",Re,m(a.name),1)])):w("",!0)],44,be))),256))],4)],32)}var g=(e,t)=>{const n=e.__vccOpts||e;for(const[o,r]of t)n[o]=r;return n};const{locationUnit:T,foundRegionColor:Pe,mistRegionColor:Ie,regionGap:ie}=De,Le=v({data(){return{downX:-1,downY:-1,nowOffsetX:0,nowOffsetY:0,timeoutHandler:null,intervalHandler:null}},computed:G({offsetX:e=>e.ui.offset[0],offsetY:e=>e.ui.offset[1],reginList:e=>{var t;return(t=e.dungeon)==null?void 0:t.regionIds.map(n=>{var o;return(o=e.dungeon)==null?void 0:o.regions[n]})}}),unmounted(){this.regionPointerUp()},methods:O(y({},P(["updateOffset","visitRegion"])),{makeRegionStyle(e){let t={};return e.status===h.mist&&(t.backgroundColor=Ie),(e.status===h.found||e.status===h.visited)&&(Object.keys(e).indexOf("name")!==-1?(t.color=ae(e.name+"-font-color",!1,!1),t.backgroundColor=ae(e.name,!1)):t.backgroundColor=Pe),e.status===h.visited&&(t.opacity=.6),y({width:e.width*T-ie+"px",height:e.height*T-ie+"px",left:e.x*T+"px",top:e.y*T+"px"},t)},pointerdown(e){this.downX=e.x,this.downY=e.y,this.nowOffsetX=this.offsetX,this.nowOffsetY=this.offsetY},pointermove(e){if(this.downX!==-1&&this.downY!==-1){let t=e.x-this.downX+this.nowOffsetX,n=e.y-this.downY+this.nowOffsetY;this.updateOffset({offset:[t,n]})}},pointerup(){this.downX=-1,this.downY=-1},regionPointerDown(e){this.visitRegion({id:e}),this.timeoutHandler=setTimeout(()=>{this.intervalHandler=setInterval(()=>{this.visitRegion({id:e})},100)},200)},regionPointerUp(){this.timeoutHandler&&clearTimeout(this.timeoutHandler),this.intervalHandler&&clearInterval(this.intervalHandler)}})});var Te=g(Le,[["render",Oe],["__scopeId","data-v-1d8c5018"]]);const Me={class:"player-panel"},je={class:"double"},Ve={class:"name"},Ye={class:"value"},Ne={class:"props"},Xe={class:"name"},He={class:"value"};function Ue(e,t,n,o,r,i){return d(),p("div",Me,[(d(!0),p(H,null,U(e.doubleValues,a=>(d(),p("div",je,[F("span",Ve,m(a.name)+":",1),F("span",Ye,m(a.value[0])+"/"+m(a.value[1]),1)]))),256)),(d(!0),p(H,null,U(e.values,a=>(d(),p("div",Ne,[F("span",Xe,m(a.name),1),F("span",He,m(a.value),1)]))),256))])}const Ge=v({computed:G({doubleValues:e=>Object.getOwnPropertySymbols(e.player.doubleValues).map(t=>e.player.doubleValues[t]).sort((t,n)=>t.order-n.order),values:e=>Object.getOwnPropertySymbols(e.player.values).map(t=>e.player.values[t]).sort((t,n)=>t.order-n.order)})});var Ke=g(Ge,[["render",Ue],["__scopeId","data-v-159582c6"]]);const qe=e=>(oe("data-v-47125f5f"),e=e(),se(),e),We={class:"ui"},Qe=qe(()=>F("div",{class:"right"},null,-1)),Je={class:"bottom"},Ze=v({setup(e){return(t,n)=>(d(),p("div",We,[Qe,F("div",Je,[K(Ke)])]))}});var ze=g(Ze,[["__scopeId","data-v-47125f5f"]]);const et={class:"main"},tt=v({setup(e){const t=he();return Ee(()=>{t.commit("generateDungeon")}),(n,o)=>(d(),p("div",et,[K(Te),K(ze)]))}}),nt={class:"title"},ot=F("div",{class:"brand"},null,-1);function st(e,t,n,o,r,i){return d(),p("div",nt,[ot,F("div",{class:"start-btn",onClick:t[0]||(t[0]=a=>e.startGame())},"\u5F00\u59CB\u6E38\u620F")])}const at=v({methods:y({},P(["startGame"]))});var rt=g(at,[["render",st]]);const it=e=>(oe("data-v-cf35f808"),e=e(),se(),e),lt={class:"container"},dt=it(()=>F("p",null,"\u9009\u62E9\u89D2\u8272",-1)),ct={class:"row"},ut=me('<span class="disable" data-v-cf35f808>\u5175</span><span class="disable" data-v-cf35f808>\u6597</span><span class="disable" data-v-cf35f808>\u8005</span><span class="disable" data-v-cf35f808>\u7686</span><span class="disable" data-v-cf35f808>\u9635</span><span class="disable" data-v-cf35f808>\u5217</span><span class="disable" data-v-cf35f808>\u524D</span><span class="disable" data-v-cf35f808>\u884C</span>',8);function Ft(e,t,n,o,r,i){return d(),p("div",lt,[dt,F("div",ct,[F("span",{onClick:t[0]||(t[0]=a=>e.selectHeroAndEnterDungeon(0))},"\u4E34"),ut])])}const ft=v({methods:y({},P(["selectHeroAndEnterDungeon"]))});var pt=g(ft,[["render",Ft],["__scopeId","data-v-cf35f808"]]);const ht={class:"title"},Et=F("div",{class:"brand"},null,-1),mt=F("div",{class:"start-btn"},"Game Over",-1);function vt(e,t,n,o,r,i){return d(),p("div",ht,[Et,mt,F("div",{class:"restart",onClick:t[0]||(t[0]=(...a)=>e.toTitle&&e.toTitle(...a))},"\u91CD\u65B0\u5F00\u59CB")])}const _t=v({methods:y({},P(["toTitle"]))});var yt=g(_t,[["render",vt]]);const Ct={class:"container"},At=v({computed:G(["stage"])}),gt=v(O(y({},At),{setup(e){return(t,n)=>(d(),p("div",Ct,[t.stage===I(E).main?(d(),L(tt,{key:0})):w("",!0),t.stage===I(E).title?(d(),L(rt,{key:1})):w("",!0),t.stage===I(E).roleSelect?(d(),L(pt,{key:2})):w("",!0),t.stage===I(E).lose?(d(),L(yt,{key:3})):w("",!0)]))}}));var Bt=g(gt,[["__scopeId","data-v-eb65aec2"]]);function B(e,t){return Math.round(Math.random()*(t-e)+e)}function q(e=.5){return Math.random()>e}const W=[{weight:1,factory:()=>({name:"\u9E21\u4ED4",hp:[10,10],attack:20,defense:5})},{weight:1,factory:()=>({name:"\u5730\u7CBE",hp:[16,16],attack:12,defense:2})}];W.sort((e,t)=>e.weight-t.weight);const b={attack:Symbol("attack"),defense:Symbol("defense")},_={hp:Symbol("hp"),mp:Symbol("mp")},Dt=[{doubleValues:{[_.hp]:{key:_.hp,name:"HP",value:[100,100],order:1},[_.mp]:{key:_.mp,name:"MP",value:[60,60],order:1}},values:{[b.attack]:{key:b.attack,name:"\u653B\u51FB\u529B",value:7,order:3},[b.defense]:{key:b.defense,name:"\u9632\u5FA1\u529B",value:6,order:2}}}],wt=W.reduce((e,t)=>e+t.weight,0);function bt(){const e=B(1,wt);let t=0;for(const n of W.reverse())if(t-=n.weight,t<e)return n;throw new Error}function $t(e){let t=1/0,n=1/0,o=-1/0,r=-1/0;for(const a of e)a.x>o&&(o=a.x),a.x<t&&(t=a.x),a.y>r&&(r=a.y),a.y<n&&(n=a.y);const i=o-t+1>=2&&r-n+1>=2;return{x:t,y:n,width:o-t+1,height:r-n+1,fits:new Set(e.map(a=>a.id)),isRoom:i,adjacent:new Set,id:e[0].id,status:h.mist,type:"blank"}}function kt(e=32){const t=[],n=s=>t[Math.floor(s/e)][s%e],o=new Set,r=[],i=({x:s,y:l},c,f)=>{var D;return((D=t[s+c])!=null?D:[])[l+f]},a=(s,l)=>([c,f])=>i({x:s,y:l},c,f),u=s=>({x:l,y:c})=>s.map(a(l,c)),V=[[[0,1]],[[0,-1]],[[1,0]],[[-1,0]],[[0,1],[0,2]],[[0,-1],[0,-2]],[[1,0],[2,0]],[[-1,0],[-2,0]],[[0,1],[0,2],[0,3]],[[0,-1],[0,-2],[0,-3]],[[1,0],[2,0],[3,0]],[[-1,0],[-2,0],[-3,0]]].map(u),S=[u([[1,0],[0,1],[1,1]]),u([[-1,0],[-1,1],[0,1]]),u([[-1,0],[-1,-1],[0,-1]]),u([[1,0],[1,-1],[0,-1]]),u([[1,0],[2,0],[2,-1],[1,-1],[0,-1]]),u([[-1,0],[-2,0],[-2,-1],[-1,-1],[0,-1]]),u([[0,1],[1,1],[2,1],[2,0],[1,0]]),u([[-1,0],[-2,0],[-2,1],[-1,1],[0,1]]),u([[1,0],[2,0],[2,-1],[1,-1],[0,-1],[0,-2],[1,-2],[2,-2]]),u([[-1,0],[-2,0],[-2,-1],[-1,-1],[0,-1],[0,-2],[-1,-2],[-2,-2],[]]),u([[0,1],[1,1],[2,1],[2,0],[1,0],[0,2],[1,2],[2,2]]),u([[-1,0],[-2,0],[-2,1],[-1,1],[0,1],[0,2],[-1,2],[-2,2]])];let x=0;for(let s=0;s<e;s++){t[s]=[];for(let l=0;l<e;l++)t[s][l]={x:s,y:l,id:x++}}const C=t.flat();for(let s=0;s<4*e;s++){const l=B(0,C.length-1),c=C[l];if(o.has(c))continue;o.add(c);const f=S.filter(A=>A(c).every(k=>k!==void 0&&!o.has(k)));if(f.length===0)continue;const $=f[B(0,f.length-1)](c);$.forEach(A=>o.add(A)),r.push([c].concat($))}for(let s=0;s<e*e;s++){const l=B(0,C.length-1),c=C[l];if(o.has(c))continue;o.add(c);const f=V.filter(A=>A(c).every(k=>k!==void 0&&!o.has(k)));if(f.length===0)continue;const $=f[B(0,f.length-1)](c);$.forEach(A=>o.add(A)),r.push([c].concat($))}const J=C.filter(s=>!o.has(s)).map(s=>[Math.abs(s.x-e/2)+Math.abs(s.y-e/2),s]).sort(([s],[l])=>s-l)[0][1],Z=O(y({},J),{width:1,height:1,fits:new Set([J.id]),status:h.found,adjacent:new Set,isRoom:!0,type:"started"}),z={},R=r.map($t).filter(s=>s.x!==0&&s.y!==0&&s.x+s.width!==e&&s.y+s.height!==e).filter(s=>!(q()&&s.fits.size<=4&&(s.width===1||s.height===1))).concat([Z]);R.forEach(s=>z[s.id]=s);for(const s of R)for(const l of s.fits.values()){const c=[[0,1],[0,-1],[1,0],[-1,0]].map(a(n(l).x,n(l).y)).filter(Boolean);R.filter(f=>c.some(D=>f.fits.has(D.id)&&f!==s)).forEach(f=>s.adjacent.add(f.id))}const Y=new Set;function ee(s){Y.has(s)||(Y.add(s),s.adjacent.forEach(l=>ee(z[l])))}return ee(Z),R.filter(s=>Y.has(s))}function St(e=32){let t=[];for(;t.filter(n=>n.isRoom).length<e;)t=kt(e);return t}function xt(e){const t=[],n={};St(32).forEach(o=>{t.push(o.id),n[o.id]=o,Rt(o)}),e.dungeon={regionIds:t,regions:n}}function Rt(e){if(e.isRoom&&e.type!=="started"&&q()){e.type="monster";const t=e,{attack:n,defense:o,hp:r,name:i}=bt().factory();t.attack=n,t.defense=o,t.hp=r,t.name=i}else if(e.isRoom&&e.type!=="started"&&q()){e.type="value";const t=e;t.name="\u8840\u6CC9",t.value=10,t.valueKey=_.hp}}function Ot(e,t){e.ui.offset=t.offset}const le={monster:{attacked:new Audio("/monster/attacked.mp3")}};class Pt{constructor(){X(this,"injuryNumbers",new Set);X(this,"cursor",[0,0])}addInjuryNumber(t){this.injuryNumbers.add(t),new _e(t).to({opacity:.8,x:t.x+B(-30,30),y:t.y+B(-30,30)},400).easing(ye.Quadratic.InOut).onComplete(()=>{this.injuryNumbers.delete(t)}).start()}addInjuryNumberAtCursor(t){const[n,o]=this.cursor;this.addInjuryNumber({opacity:1,x:n,y:o,value:t})}}const Q=new Pt;function It(){const e=document.createElement("canvas");e.width=window.innerWidth,e.height=window.innerHeight,e.style.cssText=`
    top:0;
    left:0;
    position: fixed;
    pointer-events: none;
  `,document.body.appendChild(e);const t=r=>{Q.cursor=[r.clientX,r.clientY]};window.addEventListener("pointerdown",t,{capture:!0}),window.addEventListener("pointermove",t,{capture:!0});const n=e.getContext("2d");function o(){ve(),n.clearRect(0,0,e.width,e.height),Q.injuryNumbers.forEach(r=>{const{value:i,opacity:a,x:u,y:V}=r,S=i.toString(),x=18;n.font=`${x}px Arial`,n.fillStyle=`rgba(255,0,0,${a})`;const{width:C}=n.measureText(S);n.fillText(S,u-C/2,V+x/2)}),requestAnimationFrame(o)}o()}const M=(e,t)=>{t.status===h.found&&(t.status=h.visited,t.adjacent.forEach(n=>{var r;const o=(r=e.dungeon)==null?void 0:r.regions[n];o&&o.status===h.mist&&(o.status=h.found)}))},Lt=(e,t)=>{if(!(t.status!==h.found||t.type!=="monster")&&e.player){e.player.values;const n=e.player.values[b.attack].value-t.defense,o=t.attack-e.player.values[b.defense].value;Q.addInjuryNumberAtCursor(Math.max(0,n)),t.hp[0]=Math.max(0,t.hp[0]-Math.max(0,n)),e.player.doubleValues[_.hp].value[0]=Math.max(0,e.player.doubleValues[_.hp].value[0]-Math.max(0,o)),e.player.doubleValues[_.hp].dirty=!0,le.monster.attacked.currentTime=0,le.monster.attacked.play(),t.hp[0]===0&&M(e,t)}},Tt=(e,t)=>{var o;const n=t;Object.getOwnPropertySymbols((o=e.player)==null?void 0:o.doubleValues).indexOf(n.valueKey)!==-1&&(e.player.doubleValues[n.valueKey].value[0]=Math.min(e.player.doubleValues[n.valueKey].value[1],e.player.doubleValues[n.valueKey].value[0]+n.value)),M(e,t)},Mt={started:M,blank:M,monster:Lt,value:Tt};function jt(e,{id:t}){var o;const n=(o=e.dungeon)==null?void 0:o.regions[t];if(n&&n.status===h.found){Mt[n.type](e,n);return}}function Vt(e){e.stage=E.roleSelect}function Yt(e){e.stage=E.title}function de(e){e.stage=E.main}function Nt(e){e.stage=E.lose}function Xt(e,t){e.player=Ce(Dt[t]),de(e)}var Ht=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",generateDungeon:xt,updateOffset:Ot,visitRegion:jt,startGame:Vt,enterDungeon:de,toLose:Nt,toTitle:Yt,selectHeroAndEnterDungeon:Xt});const Ut={stage:E.title,ui:{offset:[0,0]}},j=Ae({state:Ut,mutations:Ht});It();j.watch(e=>{var t,n;return(n=(t=e.player)==null?void 0:t.doubleValues[_.hp])==null?void 0:n.value[0]},e=>{e!==void 0&&e===0&&j.commit("toLose")});window.game=j;ge(Bt).use(j).mount("#game");
