var Fe=Object.defineProperty,fe=Object.defineProperties;var ve=Object.getOwnPropertyDescriptors;var oe=Object.getOwnPropertySymbols;var he=Object.prototype.hasOwnProperty,_e=Object.prototype.propertyIsEnumerable;var X=(e,t,n)=>t in e?Fe(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,A=(e,t)=>{for(var n in t||(t={}))he.call(t,n)&&X(e,n,t[n]);if(oe)for(var n of oe(t))_e.call(t,n)&&X(e,n,t[n]);return e},T=(e,t)=>fe(e,ve(t));var U=(e,t,n)=>(X(e,typeof t!="symbol"?t+"":t,n),n);import{o as c,c as u,a as d,F as K,r as G,n as j,t as m,b as y,p as se,d as ae,e as E,m as W,f as M,g as q,h as k,u as me,i as ye,j as Ee,k as V,l as Y,q as ge,T as Ce,E as Ae,s as Be,v as De,w as $e}from"./vendor.8207cf55.js";const be=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))o(s);new MutationObserver(s=>{for(const r of s)if(r.type==="childList")for(const a of r.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&o(a)}).observe(document,{childList:!0,subtree:!0});function n(s){const r={};return s.integrity&&(r.integrity=s.integrity),s.referrerpolicy&&(r.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?r.credentials="include":s.crossorigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function o(s){if(s.ep)return;s.ep=!0;const r=n(s);fetch(s.href,r)}};be();var g;(function(e){e.title="title",e.roleSelect="roleSelect",e.main="main",e.lose="lose",e.clearance="clearance"})(g||(g={}));var v;(function(e){e.found="found",e.visited="visited",e.mist="mist"})(v||(v={}));const we={locationUnit:32,regionGap:8,mistRegionColor:"#666",foundRegionColor:"#9d2"};function Q(e,t=!0,n=!0){if(e&&e.length>0){var o=t?18:15,s=n?13:9,r=ie(e)%o;t&&r>15&&(s=9);var a=ie(e)%s;return ke[a][r]}else console.log("Error: String not valid")}function ie(e){for(var t=5381,n=0;n<e.length;n++){var o=e.charCodeAt(n);t=(t<<5)+t+o}return Math.abs(t)}const ke=[["#FFEBEE","#FCE4EC","#F3E5F5","#EDE7F6","#E8EAF6","#E3F2FD","#E1F5FE","#E0F7FA","#E0F2F1","#E8F5E9","#F1F8E9","#F9FBE7","#FFFDE7","#FFF8E1","#FFF3E0","#FBE9E7","#EFEBE9","#FAFAFA","#ECEFF1"],["#FFCDD2","#F8BBD0","#E1BEE7","#D1C4E9","#C5CAE9","#BBDEFB","#B3E5FC","#B2EBF2","#B2DFDB","#C8E6C9","#DCEDC8","#F0F4C3","#FFF9C4","#FFECB3","#FFE0B2","#FFCCBC","#D7CCC8","#F5F5F5","#CFD8DC"],["#EF9A9A","#F48FB1","#CE93D8","#B39DDB","#9FA8DA","#90CAF9","#81D4FA","#80DEEA","#80CBC4","#A5D6A7","#C5E1A5","#E6EE9C","#FFF59D","#FFE082","#FFCC80","#FFAB91","#BCAAA4","#EEEEEE","#B0BEC5"],["#E57373","#F06292","#BA68C8","#9575CD","#7986CB","#64B5F6","#4FC3F7","#4DD0E1","#4DB6AC","#81C784","#AED581","#DCE775","#FFF176","#FFD54F","#FFB74D","#FF8A65","#A1887F","#E0E0E0","#90A4AE"],["#EF5350","#EC407A","#AB47BC","#7E57C2","#5C6BC0","#42A5F5","#29B6F6","#26C6DA","#26A69A","#66BB6A","#9CCC65","#D4E157","#FFEE58","#FFCA28","#FFA726","#FF7043","#8D6E63","#BDBDBD","#78909C"],["#F44336","#E91E63","#9C27B0","#673AB7","#3F51B5","#2196F3","#03A9F4","#00BCD4","#009688","#4CAF50","#8BC34A","#CDDC39","#FFEB3B","#FFC107","#FF9800","#FF5722","#795548","#9E9E9E","#607D8B"],["#E53935","#D81B60","#8E24AA","#5E35B1","#3949AB","#1E88E5","#039BE5","#00ACC1","#00897B","#43A047","#7CB342","#C0CA33","#FDD835","#FFB300","#FB8C00","#F4511E","#6D4C41","#757575","#546E7A"],["#D32F2F","#C2185B","#7B1FA2","#512DA8","#303F9F","#1976D2","#0288D1","#0097A7","#00796B","#388E3C","#689F38","#AFB42B","#FBC02D","#FFA000","#F57C00","#E64A19","#5D4037","#616161","#455A64"],["#C62828","#AD1457","#6A1B9A","#4527A0","#283593","#1565C0","#0277BD","#00838F","#00695C","#2E7D32","#558B2F","#9E9D24","#F9A825","#FF8F00","#EF6C00","#D84315","#4E342E","#424242","#37474F"],["#B71C1C","#880E4F","#4A148C","#311B92","#1A237E","#0D47A1","#01579B","#006064","#004D40","#1B5E20","#33691E","#827717","#F57F17","#FF6F00","#E65100","#BF360C","#3E2723","#212121","#263238"],["#FF8A80","#FF80AB","#EA80FC","#B388FF","#8C9EFF","#82B1FF","#80D8FF","#84FFFF","#A7FFEB","#B9F6CA","#CCFF90","#F4FF81","#FFFF8D","#FFE57F","#FFD180","#FF9E80"],["#FF5252","#FF4081","#E040FB","#7C4DFF","#536DFE","#448AFF","#40C4FF","#18FFFF","#64FFDA","#69F0AE","#B2FF59","#EEFF41","#FFFF00","#FFD740","#FFAB40","#FF6E40"],["#FF1744","#F50057","#D500F9","#651FFF","#3D5AFE","#2979FF","#00B0FF","#00E5FF","#1DE9B6","#00E676","#76FF03","#C6FF00","#FFEA00","#FFC400","#FF9100","#FF3D00"],["#D50000","#C51162","#AA00FF","#6200EA","#304FFE","#2962FF","#0091EA","#00B8D4","#00BFA5","#00C853","#64DD17","#AEEA00","#FFD600","#FFAB00","#FF6D00","#DD2C00"]],re=e=>(se("data-v-1adabe4e"),e=e(),ae(),e),Re=["onPointerenter","onPointerdown"],Se={key:0,class:"monster"},Ie={class:"name"},Pe={class:"hp"},Oe={key:1,class:"monster boss"},xe={class:"name"},Le={class:"hp"},Te={key:2,class:"value"},je={class:"name"},Me={key:3,class:"value"},Ve=re(()=>d("div",{class:"name"},"\u59CB",-1)),Ye=[Ve],He={key:4,class:"value"},Ne=re(()=>d("div",{class:"name"},"\u5B9D",-1)),Xe=[Ne];function Ue(e,t,n,o,s,r){return c(),u("div",{class:"dungeon-container",onPointerdown:t[2]||(t[2]=(...a)=>e.pointerdown&&e.pointerdown(...a)),onPointerup:t[3]||(t[3]=(...a)=>e.pointerup&&e.pointerup(...a)),onPointermove:t[4]||(t[4]=(...a)=>e.pointermove&&e.pointermove(...a))},[d("div",{class:"dungeon",style:j({top:e.offsetY+"px",left:e.offsetX+"px"})},[(c(!0),u(K,null,G(e.reginList,a=>(c(),u("div",{class:"region",style:j(e.makeRegionStyle(a)),onPointerleave:t[0]||(t[0]=(...l)=>e.regionPointerLeave&&e.regionPointerLeave(...l)),onPointerenter:l=>e.regionPointerEnter(a),onPointerdown:l=>e.regionPointerDown(a.id),onPointerup:t[1]||(t[1]=(...l)=>e.regionPointerUp&&e.regionPointerUp(...l))},[a.type==="monster"&&a.status!=="mist"?(c(),u("div",Se,[d("div",Ie,m(a.name),1),d("div",Pe,"("+m(a.hp[0])+"/"+m(a.hp[1])+")",1)])):y("",!0),a.type==="boss"&&a.status!=="mist"?(c(),u("div",Oe,[d("div",xe,m(a.name),1),d("div",Le,"("+m(a.hp[0])+"/"+m(a.hp[1])+")",1)])):y("",!0),a.type==="value"&&a.status!=="mist"?(c(),u("div",Te,[d("div",je,m(a.name),1)])):y("",!0),a.type==="started"&&a.status!=="mist"?(c(),u("div",Me,Ye)):y("",!0),a.type==="chest"&&a.status!=="mist"?(c(),u("div",He,Xe)):y("",!0)],44,Re))),256))],4)],32)}var C=(e,t)=>{const n=e.__vccOpts||e;for(const[o,s]of t)n[o]=s;return n};const{locationUnit:H,foundRegionColor:Ke,mistRegionColor:Ge,regionGap:ce}=we,We=E({data(){return{downX:-1,downY:-1,nowOffsetX:0,nowOffsetY:0,timeoutHandler:null,intervalHandler:null}},computed:W({offsetX:e=>e.ui.offset[0],offsetY:e=>e.ui.offset[1],reginList:e=>{var t;return(t=e.dungeon)==null?void 0:t.regionIds.map(n=>{var o;return(o=e.dungeon)==null?void 0:o.regions[n]})}}),unmounted(){this.regionPointerUp()},methods:T(A({},M(["updateOffset","visitRegion","updateActiveRegionId"])),{makeRegionStyle(e){let t={};return e.status===v.mist&&(t.backgroundColor=Ge),(e.status===v.found||e.status===v.visited)&&(Object.keys(e).indexOf("name")!==-1?(t.color=Q(e.name+"-font-color",!1,!1),t.backgroundColor=Q(e.name,!1)):t.backgroundColor=Ke),e.status===v.visited&&(t.opacity=.6),A({width:e.width*H-ce+"px",height:e.height*H-ce+"px",left:e.x*H+"px",top:e.y*H+"px"},t)},pointerdown(e){this.downX=e.x,this.downY=e.y,this.nowOffsetX=this.offsetX,this.nowOffsetY=this.offsetY},pointermove(e){if(this.downX!==-1&&this.downY!==-1){let t=e.x-this.downX+this.nowOffsetX,n=e.y-this.downY+this.nowOffsetY;this.updateOffset({offset:[t,n]})}},pointerup(){this.downX=-1,this.downY=-1},regionPointerDown(e){this.visitRegion({id:e}),this.timeoutHandler=setTimeout(()=>{this.intervalHandler=setInterval(()=>{this.visitRegion({id:e})},100)},200)},regionPointerUp(){this.timeoutHandler&&clearTimeout(this.timeoutHandler),this.intervalHandler&&clearInterval(this.intervalHandler)},regionPointerEnter(e){e.status===v.found&&this.updateActiveRegionId({id:e.id})},regionPointerLeave(){this.updateActiveRegionId({id:null})}})});var qe=C(We,[["render",Ue],["__scopeId","data-v-1adabe4e"]]);function Qe(e,t,n,o,s,r){return c(),u("div",{class:"icon",style:j(e.style)},null,4)}const Je=E({props:["type"],computed:{style(){return{backgroundImage:`url(icons/${this.type}.png)`,width:"16px",height:"16px",backgroundSize:"100% 100%"}}}});var Ze=C(Je,[["render",Qe]]);const ze={class:"double-bar"},et={class:"value"};function tt(e,t,n,o,s,r){return c(),u("div",ze,[d("div",{class:"fill",style:j({"background-color":e.color,left:`-${(1-e.percentage)*100}%`})},null,4),d("div",et,m(e.value),1)])}const nt=E({props:["color","value","percentage"]});var ot=C(nt,[["render",tt],["__scopeId","data-v-39186694"]]);const st={key:0,class:"region-panel"},at={key:0,class:"panel"},it=d("div",{class:"content"},"\u70B9\u51FB\u5F00\u59CB\u63A2\u7D22",-1),rt=[it],ct={key:1,class:"panel"},dt={class:"content"};function lt(e,t,n,o,s,r){return e.region?(c(),u("div",st,[e.region.type==="started"?(c(),u("div",at,rt)):y("",!0),e.region.type==="value"||e.region.type==="monster"||e.region.type==="boss"?(c(),u("div",ct,[d("div",dt,m(e.region.name)+": "+m(e.region.description),1)])):y("",!0)])):y("",!0)}const ut=E({props:["region"]});var pt=C(ut,[["render",lt]]);const Ft={class:"player-panel"},ft={class:"player-header"},vt={class:"avatar"},ht={class:"values-panel"},_t=["title"],mt={class:"icon"},yt=["title"],Et={class:"icon"},gt={class:"value"},Ct={class:"tool-tip"};function At(e,t,n,o,s,r){const a=q("icon"),l=q("DoubleBar"),b=q("RegionInfo");return c(),u("div",Ft,[d("div",ft,[d("div",vt,m(e.avatar),1),d("div",ht,[(c(!0),u(K,null,G(e.doubleValues,f=>(c(),u("div",{class:"values",title:f.name},[d("span",mt,[k(a,{type:f.icon},null,8,["type"])]),k(l,{color:e.getColorFromString(f.name+"10"),value:`${f.value[0]}/${f.value[1]}`,percentage:f.value[0]/f.value[1]},null,8,["color","value","percentage"])],8,_t))),256)),(c(!0),u(K,null,G(e.values,f=>(c(),u("div",{class:"values",title:f.name},[d("span",Et,[k(a,{type:f.icon},null,8,["type"])]),d("span",gt,m(f.value),1)],8,yt))),256))])]),d("div",Ct,[k(b,{region:e.activeRegion},null,8,["region"])])])}const Bt=E({components:{icon:Ze,DoubleBar:ot,RegionInfo:pt},methods:{getColorFromString:Q},computed:W({doubleValues:e=>Object.getOwnPropertySymbols(e.player.doubleValues).map(t=>e.player.doubleValues[t]).sort((t,n)=>t.order-n.order),values:e=>Object.getOwnPropertySymbols(e.player.values).map(t=>e.player.values[t]).sort((t,n)=>t.order-n.order),avatar:e=>e.player.avatar,activeRegion:e=>{var t;return(t=e.dungeon)==null?void 0:t.regions[e.ui.activeRegionId]}})});var Dt=C(Bt,[["render",At],["__scopeId","data-v-18a3fc5a"]]);const $t={class:"ui"},bt={class:"top"},wt=E({setup(e){return(t,n)=>(c(),u("div",$t,[d("div",bt,[k(Dt)])]))}});var kt=C(wt,[["__scopeId","data-v-4c1b6bfc"]]);const Rt={class:"main"},St=E({setup(e){const t=me();return ye(()=>{t.commit("generateDungeon")}),(n,o)=>(c(),u("div",Rt,[k(qe),k(kt)]))}}),It={class:"title"},Pt=d("div",{class:"brand"},null,-1);function Ot(e,t,n,o,s,r){return c(),u("div",It,[Pt,d("div",{class:"start-btn",onClick:t[0]||(t[0]=a=>e.startGame())},"\u620F\u4F5C")])}const xt=E({methods:A({},M(["startGame"]))});var Lt=C(xt,[["render",Ot]]);const Tt=e=>(se("data-v-d4dedccc"),e=e(),ae(),e),jt={class:"container"},Mt=Tt(()=>d("p",null,"\u62E9\u5176\u4E4B\u4E00",-1)),Vt={class:"row"},Yt=Ee('<span class="disable" data-v-d4dedccc>\u5175</span><span class="disable" data-v-d4dedccc>\u6597</span><span class="disable" data-v-d4dedccc>\u8005</span><span class="disable" data-v-d4dedccc>\u7686</span><span class="disable" data-v-d4dedccc>\u9635</span><span class="disable" data-v-d4dedccc>\u5217</span><span class="disable" data-v-d4dedccc>\u524D</span><span class="disable" data-v-d4dedccc>\u884C</span>',8);function Ht(e,t,n,o,s,r){return c(),u("div",jt,[Mt,d("div",Vt,[d("span",{onClick:t[0]||(t[0]=a=>e.selectHeroAndEnterDungeon(0))},"\u4E34"),Yt])])}const Nt=E({methods:A({},M(["selectHeroAndEnterDungeon"]))});var Xt=C(Nt,[["render",Ht],["__scopeId","data-v-d4dedccc"]]);const Ut={class:"title"},Kt=d("div",{class:"brand"},null,-1),Gt=d("div",{class:"start-btn"},"Game Over",-1);function Wt(e,t,n,o,s,r){return c(),u("div",Ut,[Kt,Gt,d("div",{class:"restart",onClick:t[0]||(t[0]=(...a)=>e.toTitle&&e.toTitle(...a))},"\u91CD\u65B0\u5F00\u59CB")])}const qt=E({methods:A({},M(["toTitle"]))});var Qt=C(qt,[["render",Wt]]);const Jt={class:"container"},Zt=E({computed:W(["stage"])}),zt=E(T(A({},Zt),{setup(e){return(t,n)=>(c(),u("div",Jt,[t.stage===V(g).main?(c(),Y(St,{key:0})):y("",!0),t.stage===V(g).title?(c(),Y(Lt,{key:1})):y("",!0),t.stage===V(g).roleSelect?(c(),Y(Xt,{key:2})):y("",!0),t.stage===V(g).lose?(c(),Y(Qt,{key:3})):y("",!0)]))}}));var en=C(zt,[["__scopeId","data-v-7ec1e746"]]);function B(e,t){return Math.round(Math.random()*(t-e)+e)}function tn(e=.5){return Math.random()>e}const J=[{weight:1,factory:()=>({name:"\u9E21",hp:[10,10],attack:12,defense:5,description:"\u653B: 12 \u9632: 5"})},{weight:1,factory:()=>({name:"\u72AC",hp:[16,16],attack:20,defense:2,description:"\u653B: 20 \u9632: 2"})}];J.sort((e,t)=>e.weight-t.weight);const D={attack:Symbol("attack"),defense:Symbol("defense")},$={hp:Symbol("hp"),mp:Symbol("mp")},nn=[{avatar:"\u4E34",doubleValues:{[$.hp]:{key:$.hp,name:"HP",value:[100,100],order:1,icon:"ui_hp"},[$.mp]:{key:$.mp,name:"MP",value:[60,60],order:2,icon:"ui_mp"}},values:{[D.attack]:{key:D.attack,name:"\u653B\u51FB\u529B",value:7,order:3,icon:"ui_attack"},[D.defense]:{key:D.defense,name:"\u9632\u5FA1\u529B",value:6,order:4,icon:"ui_defense"}}}],on=J.reduce((e,t)=>e+t.weight,0);function sn(){const e=B(1,on);let t=0;for(const n of J.reverse())if(t-=n.weight,t<e)return n;throw new Error}function an(e){const t=e.reduce((o,[s,r])=>o+r,0),n=e.sort(([o,s],[r,a])=>a-s);return()=>{const o=B(0,t);let s=0;for(const[r,a]of n)if(s+=a,s>=o)return r;throw new Error}}const rn=[[e=>{e.type="monster";const t=e,{attack:n,defense:o,hp:s,name:r,description:a}=sn().factory();t.attack=n,t.defense=o,t.hp=s,t.name=r,t.description=a},3],[e=>{e.type="value";const t=e;t.name="\u6CC9",t.value=10,t.description="HP +10",t.valueKey=$.hp},1],[e=>{e.type="value";const t=e;t.name="\u795D",t.value=3,t.description="\u653B\u51FB\u529B +3",t.valueKey=D.attack},1],[e=>{e.type="value";const t=e;t.name="\u7532",t.value=4,t.description="\u9632\u5FA1\u529B +4",t.valueKey=D.defense},1]],cn=an(rn);function dn(e){e.isRoom&&e.type==="blank"&&cn()(e)}const de=[{weight:1,factory:()=>({name:"\u72D0",hp:[100,100],attack:32,defense:13,description:"\u653B: 32 \u9632: 13"})}];de.sort((e,t)=>e.weight-t.weight);function ln(e){let t=1/0,n=1/0,o=-1/0,s=-1/0;for(const a of e)a.x>o&&(o=a.x),a.x<t&&(t=a.x),a.y>s&&(s=a.y),a.y<n&&(n=a.y);const r=o-t+1>=2&&s-n+1>=2;return{x:t,y:n,width:o-t+1,height:s-n+1,fits:new Set(e.map(a=>a.id)),isRoom:r,adjacent:new Set,id:e[0].id,status:v.mist,type:"blank"}}function un(e=32){const t=[],n=i=>t[Math.floor(i/e)][i%e],o=new Set,s=[],r=({x:i,y:p},F,h)=>{var I;return((I=t[i+F])!=null?I:[])[p+h]},a=(i,p)=>([F,h])=>r({x:i,y:p},F,h),l=i=>({x:p,y:F})=>i.map(a(p,F)),b=[[[0,1]],[[0,-1]],[[1,0]],[[-1,0]],[[0,1],[0,2]],[[0,-1],[0,-2]],[[1,0],[2,0]],[[-1,0],[-2,0]],[[0,1],[0,2],[0,3]],[[0,-1],[0,-2],[0,-3]],[[1,0],[2,0],[3,0]],[[-1,0],[-2,0],[-3,0]]].map(l),f=[l([[1,0],[0,1],[1,1]]),l([[-1,0],[-1,1],[0,1]]),l([[-1,0],[-1,-1],[0,-1]]),l([[1,0],[1,-1],[0,-1]]),l([[1,0],[2,0],[2,-1],[1,-1],[0,-1]]),l([[-1,0],[-2,0],[-2,-1],[-1,-1],[0,-1]]),l([[0,1],[1,1],[2,1],[2,0],[1,0]]),l([[-1,0],[-2,0],[-2,1],[-1,1],[0,1]]),l([[1,0],[2,0],[2,-1],[1,-1],[0,-1],[0,-2],[1,-2],[2,-2]]),l([[-1,0],[-2,0],[-2,-1],[-1,-1],[0,-1],[0,-2],[-1,-2],[-2,-2],[]]),l([[0,1],[1,1],[2,1],[2,0],[1,0],[0,2],[1,2],[2,2]]),l([[-1,0],[-2,0],[-2,1],[-1,1],[0,1],[0,2],[-1,2],[-2,2]])];let R=0;for(let i=0;i<e;i++){t[i]=[];for(let p=0;p<e;p++)t[i][p]={x:i,y:p,id:R++}}const _=t.flat();for(let i=0;i<4*e;i++){const p=B(0,_.length-1),F=_[p];if(o.has(F))continue;o.add(F);const h=f.filter(w=>w(F).every(O=>O!==void 0&&!o.has(O)));if(h.length===0)continue;const P=h[B(0,h.length-1)](F);P.forEach(w=>o.add(w)),s.push([F].concat(P))}for(let i=0;i<e*e;i++){const p=B(0,_.length-1),F=_[p];if(o.has(F))continue;o.add(F);const h=b.filter(w=>w(F).every(O=>O!==void 0&&!o.has(O)));if(h.length===0)continue;const P=h[B(0,h.length-1)](F);P.forEach(w=>o.add(w)),s.push([F].concat(P))}const z=_.filter(i=>!o.has(i)).map(i=>[Math.abs(i.x-e/2)+Math.abs(i.y-e/2),i]).sort(([i],[p])=>i-p)[0][1],ee=T(A({},z),{width:1,height:1,fits:new Set([z.id]),status:v.found,adjacent:new Set,isRoom:!0,type:"started"}),te={};let S=s.map(ln).filter(i=>i.x!==0&&i.y!==0&&i.x+i.width!==e&&i.y+i.height!==e).filter(i=>!(tn()&&i.fits.size<=4&&(i.width===1||i.height===1))).concat([ee]);S.forEach(i=>te[i.id]=i);for(const i of S)for(const p of i.fits.values()){const F=[[0,1],[0,-1],[1,0],[-1,0]].map(a(n(p).x,n(p).y)).filter(Boolean);S.filter(h=>F.some(I=>h.fits.has(I.id)&&h!==i)).forEach(h=>i.adjacent.add(h.id))}const N=new Set;function ne(i){N.has(i)||(N.add(i),i.adjacent.forEach(p=>ne(te[p])))}return ne(ee),S=S.filter(i=>N.has(i)),S}function pn(e=32){let t=[];for(;t.filter(n=>n.isRoom).length<e;)t=un(e);return t}function Fn(e){const t=[],n={},o=pn(32),s=[];o.forEach(_=>{t.push(_.id),n[_.id]=_,_.isRoom&&_.type==="blank"&&s.push(_)}),s[0].type="boss";const r=s[0],{defense:a,attack:l,hp:b,name:f,description:R}=de[0].factory();r.attack=l,r.defense=a,r.hp=b,r.name=f,r.description=R,s.forEach(dn),e.dungeon={regionIds:t,regions:n}}function fn(e,t){e.ui.offset=t.offset}function vn(e,t){e.ui.activeRegionId=t.id}const le={monster:{attacked:new Audio("/monster/attacked.mp3")}};class hn{constructor(){U(this,"injuryNumbers",new Set);U(this,"cursor",[0,0])}addInjuryNumber(t){this.injuryNumbers.add(t),new Ce(t).to({opacity:.8,x:t.x+B(-30,30),y:t.y+B(-30,30)},400).easing(Ae.Quadratic.InOut).onComplete(()=>{this.injuryNumbers.delete(t)}).start()}addInjuryNumberAtCursor(t){const[n,o]=this.cursor;this.addInjuryNumber({opacity:1,x:n,y:o,value:t})}}const Z=new hn;function _n(){const e=document.createElement("canvas");e.width=window.innerWidth,e.height=window.innerHeight,e.style.cssText=`
    top:0;
    left:0;
    position: fixed;
    pointer-events: none;
  `,document.body.appendChild(e);const t=s=>{Z.cursor=[s.clientX,s.clientY]};window.addEventListener("pointerdown",t,{capture:!0}),window.addEventListener("pointermove",t,{capture:!0});const n=e.getContext("2d");function o(){ge(),n.clearRect(0,0,e.width,e.height),Z.injuryNumbers.forEach(s=>{const{value:r,opacity:a,x:l,y:b}=s,f=r.toString(),R=18;n.font=`${R}px Arial`,n.fillStyle=`rgba(255,0,0,${a})`;const{width:_}=n.measureText(f);n.fillText(f,l-_/2,b+R/2)}),requestAnimationFrame(o)}o()}const x=(e,t)=>{t.status===v.found&&(t.status=v.visited,t.adjacent.forEach(n=>{var s;const o=(s=e.dungeon)==null?void 0:s.regions[n];o&&o.status===v.mist&&(o.status=v.found)}))},ue=(e,t)=>{if(!(t.status!==v.found||t.type!=="monster"&&t.type!=="boss")&&e.player){e.player.values;const n=e.player.values[D.attack].value-t.defense,o=t.attack-e.player.values[D.defense].value;Z.addInjuryNumberAtCursor(-Math.max(0,n)),t.hp[0]=Math.max(0,t.hp[0]-Math.max(0,n)),e.player.doubleValues[$.hp].value[0]=Math.max(0,e.player.doubleValues[$.hp].value[0]-Math.max(0,o)),le.monster.attacked.currentTime=0,le.monster.attacked.play(),t.hp[0]===0&&(x(e,t),t.type==="boss"&&(t.status=v.found,t.type="chest",t.from="boss"))}},mn=(e,t)=>{alert("TODO: \u8FD9\u91CC\u5E94\u8BE5\u6709\u4E2A\u9009\u62E9\u5956\u52B1\u7684\u754C\u9762"),x(e,t)},yn=(e,t)=>{var o,s;const n=t;Object.getOwnPropertySymbols((o=e.player)==null?void 0:o.doubleValues).indexOf(n.valueKey)!==-1&&(e.player.doubleValues[n.valueKey].value[0]=Math.min(e.player.doubleValues[n.valueKey].value[1],e.player.doubleValues[n.valueKey].value[0]+n.value)),Object.getOwnPropertySymbols((s=e.player)==null?void 0:s.values).indexOf(n.valueKey)!==-1&&(e.player.values[n.valueKey].value=e.player.values[n.valueKey].value+n.value),x(e,t)},En={started:x,blank:x,monster:ue,boss:ue,chest:mn,value:yn};function gn(e,{id:t}){var o;const n=(o=e.dungeon)==null?void 0:o.regions[t];if(n&&n.status===v.found){En[n.type](e,n);return}}function Cn(e){var t;(t=e.dungeon)==null||t.regionIds.forEach(n=>{var s;const o=(s=e.dungeon)==null?void 0:s.regions[n];(o==null?void 0:o.status)===v.mist&&(o.status=v.found)})}function An(e){e.stage=g.roleSelect}function Bn(e){e.stage=g.title}function pe(e){e.stage=g.main}function Dn(e){e.stage=g.lose}function $n(e,t){e.player=Be(nn[t]),pe(e)}var bn=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",generateDungeon:Fn,updateOffset:fn,updateActiveRegionId:vn,visitRegion:gn,foundAllRegion:Cn,startGame:An,enterDungeon:pe,toLose:Dn,toTitle:Bn,selectHeroAndEnterDungeon:$n});const wn={stage:g.title,ui:{offset:[0,0]}},L=De({state:wn,mutations:bn});window._debugger={foundAllRegion:()=>L.commit("foundAllRegion")};_n();L.watch(e=>{var t,n;return(n=(t=e.player)==null?void 0:t.doubleValues[$.hp])==null?void 0:n.value[0]},e=>{e!==void 0&&e===0&&L.commit("toLose")});window.game=L;$e(en).use(L).mount("#game");
